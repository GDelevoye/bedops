
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>6.2.1. bedmap &#8212; BEDOPS v2.4.36</title>
    <link rel="stylesheet" href="../../../_static/better.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="6.3. File management" href="../file-management.html" />
    <link rel="prev" title="6.2. Statistics" href="../statistics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  </head><body>
    <header id="pageheader"><h1><a href="../../../index.html ">
        BEDOPS v2.4.36
    </a></h1></header>
  <div class="related top">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="../statistics.html" title="Previous document">6.2. Statistics</a>
        </li>
        <li>
          <a href="../file-management.html" title="Next document">6.3. File management</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../../../index.html">Home</a></li>
      <li>
        <a href="../../reference.html">6. Reference</a>
      </li>
      <li>
        <a href="../statistics.html">6.2. Statistics</a>
      </li> 
    </ul>
  </nav>
  </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="bedmap">
<span id="id1"></span><h1>6.2.1. <cite>bedmap</cite><a class="headerlink" href="#bedmap" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">bedmap</span></code> program is used to retrieve and process signal or other features over regions of interest in BED files (including DNase hypersensitive regions, SNPs, transcription factor binding sites, etc.), performing tasks such as: <a class="reference internal" href="../../usage-examples/smoothing-tags.html#smoothing-raw-tags"><span class="std std-ref">smoothing raw tag</span></a> count signal in preparation for uploading to the UCSC Genome Browser, <a class="reference internal" href="../../usage-examples/snps-within-dhses.html#finding-elements-within-elements"><span class="std std-ref">finding subsets of elements</span></a> within a larger coordinate set, <a class="reference internal" href="../../usage-examples/master-list.html#master-list"><span class="std std-ref">filtering multiple BED files</span></a> by signal, <a class="reference internal" href="../../usage-examples/multiple-inputs.html#multiple-inputs"><span class="std std-ref">finding multi-input overlap</span></a> solutions, and much, much more.</p>
<div class="section" id="inputs-and-outputs">
<h2>6.2.1.1. Inputs and outputs<a class="headerlink" href="#inputs-and-outputs" title="Permalink to this headline">¶</a></h2>
<div class="section" id="input">
<h3>6.2.1.1.1. Input<a class="headerlink" href="#input" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> program takes in <em>reference</em> and <em>mapping</em> files and calculates statistics for each reference element. These calculations—<em>operations</em>—are applied to overlapping elements from the mapped file:</p>
<a class="reference internal image-reference" href="../../../_images/reference_bedmap_inputs.png"><img alt="../../../_images/reference_bedmap_inputs.png" src="../../../_images/reference_bedmap_inputs.png" style="width: 99%;" /></a>
<p>The <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> program requires files in a relaxed variation of the BED format as described by <a class="reference external" href="http://genome.ucsc.edu/FAQ/FAQformat.html#format1">UCSC’s browser documentation</a>. The chromosome field can be any non-empty string, the score field can be any valid numeric value, and information is unconstrained beyond the minimum number of columns required by the chosen options.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Information is unconstrained, with one important exception: Map input (defined below) should not contain spaces in the ID or in subsequent fields. Running <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> with <code class="code docutils literal notranslate"><span class="pre">--ec</span></code> will identify problematic input.</p>
<p class="last">An <code class="code docutils literal notranslate"><span class="pre">awk</span></code> script can help with translating ID spaces to another non-whitespace delimiter, <em>e.g.</em>, <code class="code docutils literal notranslate"><span class="pre">bedmap</span> <span class="pre">(--options...)</span> <span class="pre">reference.bed</span> <span class="pre">&lt;(awk</span> <span class="pre">-vOFS=&quot;\t&quot;</span> <span class="pre">-vFS=&quot;\t&quot;</span> <span class="pre">'{gsub(&quot;</span> <span class="pre">&quot;,</span> <span class="pre">&quot;%%&quot;,</span> <span class="pre">$4);</span> <span class="pre">print;}'</span> <span class="pre">map.bed)</span></code> and then <cite>awk -vOFS=”t” -vFS=”t” ‘{gsub(“%%”, ” “); print;}’ result.bed</cite> to convert delimiters back to spaces.</p>
</div>
<p>Alternatively, <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> can accept <a class="reference internal" href="../file-management/compression/starch.html#starch"><span class="std std-ref">Starch-formatted archives</span></a> of BED data as input—it is no longer necessary to extract Starch archive data to intermediate BED files!</p>
<p>Support for common headers (including UCSC browser track headers) is available with the <code class="docutils literal notranslate"><span class="pre">--header</span></code> option, although headers are stripped from output.</p>
<p>Most importantly, <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> expects <a class="reference internal" href="../file-management/sorting/sort-bed.html#sort-bed"><span class="std std-ref">sorted</span></a> inputs. You can use the BEDOPS <a class="reference internal" href="../file-management/sorting/sort-bed.html#sort-bed"><span class="std std-ref">sort-bed</span></a> program to ensure your inputs are properly sorted.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You only need to sort once, and only if your input data are unsorted, as all BEDOPS tools take in and export sorted BED data.</p>
</div>
<p>Operations are applied over map elements that overlap the coordinates of each reference element. You can use the default overlap criterion of one base, or define your own criteria using the <a class="reference internal" href="#bedmap-overlap-criteria"><span class="std std-ref">overlap criteria operators</span></a>.</p>
<p>Once you have overlapping elements, you can either perform <a class="reference internal" href="#bedmap-score-operations"><span class="std std-ref">numerical calculations</span></a> on their scores or return identifiers or other <a class="reference internal" href="#bedmap-non-score-operations"><span class="std std-ref">non-score information</span></a>. Additional <a class="reference internal" href="#bedmap-modifier-operations"><span class="std std-ref">modifier operators</span></a> allow customization of how output is presented, to assist with downstream processing in a pipeline setting.</p>
</div>
<div class="section" id="output">
<h3>6.2.1.1.2. Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<p>Depending on specified options, the <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> program can send a variety of delimited information about the reference and mapped elements (as well as analytical results) to standard output. If the <code class="docutils literal notranslate"><span class="pre">--echo</span></code> option is used, the output will be at least a three-column BED file. The use of predictable delimiters (which are customizable) and the use of UNIX-like standard streams allows easy downstream analysis or post-processing with other tools and scripts.</p>
</div>
</div>
<div class="section" id="usage">
<h2>6.2.1.2. Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">--help</span></code> option describes the various mapping and analytical operations and other options available to the end user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bedmap</span>
  <span class="n">citation</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">bioinformatics</span><span class="o">.</span><span class="n">oxfordjournals</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="mi">28</span><span class="o">/</span><span class="mi">14</span><span class="o">/</span><span class="mf">1919.</span><span class="n">abstract</span>
  <span class="n">version</span><span class="p">:</span>  <span class="mf">2.4</span><span class="o">.</span><span class="mi">36</span> <span class="p">(</span><span class="n">typical</span><span class="p">)</span>
  <span class="n">authors</span><span class="p">:</span>  <span class="n">Shane</span> <span class="n">Neph</span> <span class="o">&amp;</span> <span class="n">Scott</span> <span class="n">Kuehn</span>

 <span class="n">USAGE</span><span class="p">:</span> <span class="n">bedmap</span> <span class="p">[</span><span class="n">process</span><span class="o">-</span><span class="n">flags</span><span class="p">]</span> <span class="p">[</span><span class="n">overlap</span><span class="o">-</span><span class="n">option</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">operation</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">...&gt;</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="p">[</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="p">]</span>
     <span class="n">Any</span> <span class="nb">input</span> <span class="n">file</span> <span class="n">must</span> <span class="n">be</span> <span class="nb">sorted</span> <span class="n">per</span> <span class="n">the</span> <span class="n">sort</span><span class="o">-</span><span class="n">bed</span> <span class="n">utility</span><span class="o">.</span>
     <span class="n">The</span> <span class="n">program</span> <span class="n">accepts</span> <span class="n">BED</span> <span class="ow">and</span> <span class="n">Starch</span> <span class="n">file</span> <span class="n">formats</span><span class="o">.</span>
     <span class="n">You</span> <span class="n">may</span> <span class="n">use</span> <span class="s1">&#39;-&#39;</span> <span class="k">for</span> <span class="n">a</span> <span class="n">BED</span> <span class="n">file</span> <span class="n">to</span> <span class="n">indicate</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">comes</span> <span class="kn">from</span> <span class="nn">stdin.</span>

     <span class="n">Traverse</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">while</span> <span class="n">applying</span> <span class="o">&lt;</span><span class="n">operation</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">on</span> <span class="n">qualified</span><span class="p">,</span> <span class="n">overlapping</span> <span class="n">elements</span> <span class="kn">from</span>
       <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>  <span class="n">Output</span> <span class="ow">is</span> <span class="n">one</span> <span class="n">line</span> <span class="k">for</span> <span class="n">each</span> <span class="n">line</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">sent</span> <span class="n">to</span> <span class="n">standard</span> <span class="n">output</span><span class="o">.</span>  <span class="n">There</span>
       <span class="ow">is</span> <span class="n">no</span> <span class="n">limit</span> <span class="n">on</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">operations</span> <span class="n">you</span> <span class="n">can</span> <span class="n">specify</span> <span class="n">to</span> <span class="n">compute</span> <span class="ow">in</span> <span class="n">one</span> <span class="n">bedmap</span> <span class="n">call</span><span class="o">.</span>
     <span class="n">If</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="ow">is</span> <span class="n">omitted</span><span class="p">,</span> <span class="n">the</span> <span class="n">given</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">treated</span> <span class="k">as</span> <span class="n">both</span> <span class="n">the</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="ow">and</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
       <span class="n">This</span> <span class="n">usage</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">efficient</span> <span class="n">than</span> <span class="n">specifying</span> <span class="n">the</span> <span class="n">same</span> <span class="n">file</span> <span class="n">twice</span><span class="o">.</span>
     <span class="n">Arguments</span> <span class="n">may</span> <span class="n">be</span> <span class="n">given</span> <span class="ow">in</span> <span class="nb">any</span> <span class="n">order</span> <span class="n">before</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span>

    <span class="n">Process</span> <span class="n">Flags</span><span class="p">:</span>
     <span class="o">--------</span>
      <span class="o">--</span><span class="n">chrom</span> <span class="o">&lt;</span><span class="n">chromosome</span><span class="o">&gt;</span>  <span class="n">Jump</span> <span class="n">to</span> <span class="ow">and</span> <span class="n">process</span> <span class="n">data</span> <span class="k">for</span> <span class="n">given</span> <span class="o">&lt;</span><span class="n">chromosome</span><span class="o">&gt;</span> <span class="n">only</span><span class="o">.</span>
      <span class="o">--</span><span class="n">delim</span> <span class="o">&lt;</span><span class="n">delim</span><span class="o">&gt;</span>       <span class="n">Change</span> <span class="n">output</span> <span class="n">delimiter</span> <span class="kn">from</span> <span class="s1">&#39;|&#39;</span> <span class="n">to</span> <span class="o">&lt;</span><span class="n">delim</span><span class="o">&gt;</span> <span class="n">between</span> <span class="n">columns</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span>
      <span class="o">--</span><span class="n">ec</span>                  <span class="n">Error</span> <span class="n">check</span> <span class="nb">all</span> <span class="nb">input</span> <span class="n">files</span> <span class="p">(</span><span class="n">slower</span><span class="p">)</span><span class="o">.</span>
      <span class="o">--</span><span class="n">faster</span>              <span class="p">(</span><span class="n">advanced</span><span class="p">)</span> <span class="n">Strong</span> <span class="nb">input</span> <span class="n">assumptions</span> <span class="n">are</span> <span class="n">made</span><span class="o">.</span>  <span class="n">Compatible</span> <span class="k">with</span><span class="p">:</span>
                              <span class="o">--</span><span class="n">bp</span><span class="o">-</span><span class="n">ovr</span><span class="p">,</span> <span class="o">--</span><span class="nb">range</span><span class="p">,</span> <span class="o">--</span><span class="n">fraction</span><span class="o">-</span><span class="n">both</span><span class="p">,</span> <span class="ow">and</span> <span class="o">--</span><span class="n">exact</span> <span class="n">overlap</span> <span class="n">options</span> <span class="n">only</span><span class="o">.</span>
      <span class="o">--</span><span class="n">header</span>              <span class="n">Accept</span> <span class="n">headers</span> <span class="p">(</span><span class="n">VCF</span><span class="p">,</span> <span class="n">GFF</span><span class="p">,</span> <span class="n">SAM</span><span class="p">,</span> <span class="n">BED</span><span class="p">,</span> <span class="n">WIG</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">any</span> <span class="nb">input</span> <span class="n">file</span><span class="o">.</span>
      <span class="o">--</span><span class="n">help</span>                <span class="n">Print</span> <span class="n">this</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span> <span class="n">successfully</span><span class="o">.</span>
      <span class="o">--</span><span class="nb">min</span><span class="o">-</span><span class="n">memory</span>          <span class="n">Minimize</span> <span class="n">memory</span> <span class="n">usage</span> <span class="p">(</span><span class="n">slower</span><span class="p">)</span><span class="o">.</span>
      <span class="o">--</span><span class="n">multidelim</span> <span class="o">&lt;</span><span class="n">delim</span><span class="o">&gt;</span>  <span class="n">Change</span> <span class="n">delimiter</span> <span class="n">of</span> <span class="n">multi</span><span class="o">-</span><span class="n">value</span> <span class="n">output</span> <span class="n">columns</span> <span class="kn">from</span> <span class="s1">&#39;;&#39;</span> <span class="n">to</span> <span class="o">&lt;</span><span class="n">delim</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">prec</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span>          <span class="n">Change</span> <span class="n">the</span> <span class="n">post</span><span class="o">-</span><span class="n">decimal</span> <span class="n">precision</span> <span class="n">of</span> <span class="n">scores</span> <span class="n">to</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;.</span>  <span class="mi">0</span> <span class="o">&lt;=</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">sci</span>                 <span class="n">Use</span> <span class="n">scientific</span> <span class="n">notation</span> <span class="k">for</span> <span class="n">score</span> <span class="n">outputs</span><span class="o">.</span>
      <span class="o">--</span><span class="n">skip</span><span class="o">-</span><span class="n">unmapped</span>       <span class="n">Print</span> <span class="n">no</span> <span class="n">output</span> <span class="k">for</span> <span class="n">a</span> <span class="n">row</span> <span class="k">with</span> <span class="n">no</span> <span class="n">mapped</span> <span class="n">elements</span><span class="o">.</span>
      <span class="o">--</span><span class="n">sweep</span><span class="o">-</span><span class="nb">all</span>           <span class="n">Ensure</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="ow">is</span> <span class="n">read</span> <span class="n">completely</span> <span class="p">(</span><span class="n">helps</span> <span class="n">to</span> <span class="n">prevent</span> <span class="n">broken</span> <span class="n">pipes</span><span class="p">)</span><span class="o">.</span>
      <span class="o">--</span><span class="n">unmapped</span><span class="o">-</span><span class="n">val</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span>  <span class="n">Print</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span> <span class="n">on</span> <span class="n">unmapped</span> <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="nb">map</span><span class="o">*</span> <span class="ow">and</span> <span class="o">--</span><span class="nb">min</span><span class="o">/</span><span class="nb">max</span><span class="o">-</span><span class="n">element</span><span class="o">*</span> <span class="n">operations</span><span class="o">.</span>
                              <span class="n">The</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">to</span> <span class="nb">print</span> <span class="n">nothing</span><span class="o">.</span>
      <span class="o">--</span><span class="n">unmapped</span><span class="o">-</span><span class="n">val</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span>  <span class="n">Use</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">place</span> <span class="n">of</span> <span class="n">the</span> <span class="n">empty</span> <span class="n">string</span> <span class="n">on</span> <span class="n">unmapped</span> <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="nb">map</span><span class="o">*</span> <span class="n">ops</span><span class="o">.</span>
      <span class="o">--</span><span class="n">version</span>             <span class="n">Print</span> <span class="n">program</span> <span class="n">information</span><span class="o">.</span>

    <span class="n">Overlap</span> <span class="n">Options</span> <span class="p">(</span><span class="n">At</span> <span class="n">most</span><span class="p">,</span> <span class="n">one</span> <span class="n">may</span> <span class="n">be</span> <span class="n">selected</span><span class="o">.</span>  <span class="n">By</span> <span class="n">default</span><span class="p">,</span> <span class="o">--</span><span class="n">bp</span><span class="o">-</span><span class="n">ovr</span> <span class="mi">1</span> <span class="ow">is</span> <span class="n">used</span><span class="p">):</span>
     <span class="o">--------</span>
      <span class="o">--</span><span class="n">bp</span><span class="o">-</span><span class="n">ovr</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span>           <span class="n">Require</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span> <span class="n">bp</span> <span class="n">overlap</span> <span class="n">between</span> <span class="n">elements</span> <span class="n">of</span> <span class="nb">input</span> <span class="n">files</span><span class="o">.</span>
      <span class="o">--</span><span class="n">exact</span>                  <span class="n">First</span> <span class="mi">3</span> <span class="n">fields</span> <span class="kn">from</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">must</span> <span class="n">be</span> <span class="n">identical</span> <span class="n">to</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span><span class="s1">&#39;s.</span>
      <span class="o">--</span><span class="n">fraction</span><span class="o">-</span><span class="n">ref</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span>     <span class="n">The</span> <span class="n">fraction</span> <span class="n">of</span> <span class="n">the</span> <span class="n">element</span><span class="s1">&#39;s size from &lt;ref-file&gt; that must overlap</span>
                                 <span class="n">the</span> <span class="n">element</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>  <span class="n">Expect</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">1.</span>
      <span class="o">--</span><span class="n">fraction</span><span class="o">-</span><span class="nb">map</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span>     <span class="n">The</span> <span class="n">fraction</span> <span class="n">of</span> <span class="n">the</span> <span class="n">element</span><span class="s1">&#39;s size from &lt;map-file&gt; that must overlap</span>
                                 <span class="n">the</span> <span class="n">element</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>  <span class="n">Expect</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">1.</span>
      <span class="o">--</span><span class="n">fraction</span><span class="o">-</span><span class="n">both</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span>    <span class="n">Both</span> <span class="o">--</span><span class="n">fraction</span><span class="o">-</span><span class="n">ref</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span> <span class="ow">and</span> <span class="o">--</span><span class="n">fraction</span><span class="o">-</span><span class="nb">map</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span> <span class="n">must</span> <span class="n">be</span> <span class="n">true</span> <span class="n">to</span>
                                 <span class="n">qualify</span> <span class="k">as</span> <span class="n">overlapping</span><span class="o">.</span>  <span class="n">Expect</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">1.</span>
      <span class="o">--</span><span class="n">fraction</span><span class="o">-</span><span class="n">either</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span>  <span class="n">Either</span> <span class="o">--</span><span class="n">fraction</span><span class="o">-</span><span class="n">ref</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span> <span class="ow">or</span> <span class="o">--</span><span class="n">fraction</span><span class="o">-</span><span class="nb">map</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span> <span class="n">must</span> <span class="n">be</span> <span class="n">true</span> <span class="n">to</span>
                                 <span class="n">qualify</span> <span class="k">as</span> <span class="n">overlapping</span><span class="o">.</span>  <span class="n">Expect</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">1.</span>
      <span class="o">--</span><span class="nb">range</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span>            <span class="n">Grab</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">elements</span> <span class="n">within</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span> <span class="n">bp</span> <span class="n">of</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span><span class="s1">&#39;s element,</span>
                                 <span class="n">where</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="o">.</span>  <span class="o">--</span><span class="nb">range</span> <span class="mi">0</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">alias</span> <span class="k">for</span> <span class="o">--</span><span class="n">bp</span><span class="o">-</span><span class="n">ovr</span> <span class="mf">1.</span>

    <span class="n">Operations</span><span class="p">:</span>  <span class="p">(</span><span class="n">Any</span> <span class="n">number</span> <span class="n">of</span> <span class="n">operations</span> <span class="n">may</span> <span class="n">be</span> <span class="n">used</span> <span class="nb">any</span> <span class="n">number</span> <span class="n">of</span> <span class="n">times</span><span class="o">.</span><span class="p">)</span>
     <span class="o">----------</span>
      <span class="n">SCORE</span><span class="p">:</span>
       <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">must</span> <span class="n">have</span> <span class="n">at</span> <span class="n">least</span> <span class="mi">3</span> <span class="n">columns</span> <span class="ow">and</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="mi">5</span> <span class="n">columns</span><span class="o">.</span>

      <span class="o">--</span><span class="n">cv</span>                <span class="n">The</span> <span class="n">result</span> <span class="n">of</span> <span class="o">--</span><span class="n">stdev</span> <span class="n">divided</span> <span class="n">by</span> <span class="n">the</span> <span class="n">result</span> <span class="n">of</span> <span class="o">--</span><span class="n">mean</span><span class="o">.</span>
      <span class="o">--</span><span class="n">kth</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span>         <span class="n">Generalized</span> <span class="n">median</span><span class="o">.</span> <span class="n">Report</span> <span class="n">the</span> <span class="n">value</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">such</span> <span class="n">that</span> <span class="n">the</span> <span class="n">fraction</span> <span class="o">&lt;</span><span class="n">val</span><span class="o">&gt;</span>
                            <span class="n">of</span> <span class="n">overlapping</span> <span class="n">elements</span><span class="s1">&#39; scores from &lt;map-file&gt; is less than x,</span>
                            <span class="ow">and</span> <span class="n">the</span> <span class="n">fraction</span> <span class="mi">1</span><span class="o">-&lt;</span><span class="n">val</span><span class="o">&gt;</span> <span class="n">of</span> <span class="n">scores</span> <span class="ow">is</span> <span class="n">greater</span> <span class="n">than</span> <span class="n">x</span><span class="o">.</span>  <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">1.</span>
      <span class="o">--</span><span class="n">mad</span> <span class="o">&lt;</span><span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="o">&gt;</span>      <span class="n">The</span> <span class="n">median</span> <span class="n">absolute</span> <span class="n">deviation</span> <span class="n">of</span> <span class="n">overlapping</span> <span class="n">elements</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
                            <span class="n">Multiply</span> <span class="n">mad</span> <span class="n">score</span> <span class="n">by</span> <span class="o">&lt;</span><span class="n">mult</span><span class="o">&gt;.</span>  <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">mult</span><span class="p">,</span> <span class="ow">and</span> <span class="n">mult</span> <span class="ow">is</span> <span class="mi">1</span> <span class="n">by</span> <span class="n">default</span><span class="o">.</span>
      <span class="o">--</span><span class="nb">max</span>               <span class="n">The</span> <span class="n">highest</span> <span class="n">score</span> <span class="kn">from</span> <span class="nn">overlapping</span> <span class="n">elements</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="nb">max</span><span class="o">-</span><span class="n">element</span>       <span class="n">A</span> <span class="p">(</span><span class="n">non</span><span class="o">-</span><span class="n">random</span><span class="p">)</span> <span class="n">highest</span><span class="o">-</span><span class="n">scoring</span> <span class="ow">and</span> <span class="n">overlapping</span> <span class="n">element</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="nb">max</span><span class="o">-</span><span class="n">element</span><span class="o">-</span><span class="n">rand</span>  <span class="n">A</span> <span class="n">random</span> <span class="n">highest</span><span class="o">-</span><span class="n">scoring</span> <span class="ow">and</span> <span class="n">overlapping</span> <span class="n">element</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">mean</span>              <span class="n">The</span> <span class="n">average</span> <span class="n">score</span> <span class="kn">from</span> <span class="nn">overlapping</span> <span class="n">elements</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">median</span>            <span class="n">The</span> <span class="n">median</span> <span class="n">score</span> <span class="kn">from</span> <span class="nn">overlapping</span> <span class="n">elements</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="nb">min</span>               <span class="n">The</span> <span class="n">lowest</span> <span class="n">score</span> <span class="kn">from</span> <span class="nn">overlapping</span> <span class="n">elements</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="nb">min</span><span class="o">-</span><span class="n">element</span>       <span class="n">A</span> <span class="p">(</span><span class="n">non</span><span class="o">-</span><span class="n">random</span><span class="p">)</span> <span class="n">lowest</span><span class="o">-</span><span class="n">scoring</span> <span class="ow">and</span> <span class="n">overlapping</span> <span class="n">element</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="nb">min</span><span class="o">-</span><span class="n">element</span><span class="o">-</span><span class="n">rand</span>  <span class="n">A</span> <span class="n">random</span> <span class="n">lowest</span><span class="o">-</span><span class="n">scoring</span> <span class="ow">and</span> <span class="n">overlapping</span> <span class="n">element</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">stdev</span>             <span class="n">The</span> <span class="n">square</span> <span class="n">root</span> <span class="n">of</span> <span class="n">the</span> <span class="n">result</span> <span class="n">of</span> <span class="o">--</span><span class="n">variance</span><span class="o">.</span>
      <span class="o">--</span><span class="nb">sum</span>               <span class="n">Accumulated</span> <span class="n">scores</span> <span class="kn">from</span> <span class="nn">overlapping</span> <span class="n">elements</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">tmean</span> <span class="o">&lt;</span><span class="n">low</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">hi</span><span class="o">&gt;</span>  <span class="n">The</span> <span class="n">mean</span> <span class="n">score</span> <span class="kn">from</span> <span class="nn">overlapping</span> <span class="n">elements</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">after</span>
                            <span class="n">ignoring</span> <span class="n">the</span> <span class="n">bottom</span> <span class="o">&lt;</span><span class="n">low</span><span class="o">&gt;</span> <span class="ow">and</span> <span class="n">top</span> <span class="o">&lt;</span><span class="n">hi</span><span class="o">&gt;</span> <span class="n">fractions</span> <span class="n">of</span> <span class="n">those</span> <span class="n">scores</span><span class="o">.</span>
                            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">low</span> <span class="o">&lt;=</span> <span class="mf">1.</span>  <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">hi</span> <span class="o">&lt;=</span> <span class="mf">1.</span>  <span class="n">low</span><span class="o">+</span><span class="n">hi</span> <span class="o">&lt;=</span> <span class="mf">1.</span>
      <span class="o">--</span><span class="n">variance</span>          <span class="n">The</span> <span class="n">variance</span> <span class="n">of</span> <span class="n">scores</span> <span class="kn">from</span> <span class="nn">overlapping</span> <span class="n">elements</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">wmean</span>             <span class="n">Weighted</span> <span class="n">mean</span><span class="p">,</span> <span class="n">scaled</span> <span class="ow">in</span> <span class="n">proportion</span> <span class="n">to</span> <span class="n">the</span> <span class="n">coverage</span> <span class="n">of</span> <span class="n">the</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span>
                            <span class="n">element</span> <span class="n">by</span> <span class="n">each</span> <span class="n">overlapping</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">element</span><span class="o">.</span>

     <span class="o">----------</span>
      <span class="n">NON</span><span class="o">-</span><span class="n">SCORE</span><span class="p">:</span>
       <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">must</span> <span class="n">have</span> <span class="n">at</span> <span class="n">least</span> <span class="mi">3</span> <span class="n">columns</span><span class="o">.</span>
       <span class="n">For</span> <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="nb">id</span><span class="o">/</span><span class="n">echo</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="nb">id</span><span class="o">-</span><span class="n">uniq</span><span class="p">,</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">must</span> <span class="n">have</span> <span class="n">at</span> <span class="n">least</span> <span class="mi">4</span> <span class="n">columns</span><span class="o">.</span>
       <span class="n">For</span> <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="n">score</span><span class="p">,</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">must</span> <span class="n">have</span> <span class="n">at</span> <span class="n">least</span> <span class="mi">5</span> <span class="n">columns</span><span class="o">.</span>
       <span class="n">For</span> <span class="nb">all</span> <span class="n">others</span><span class="p">,</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">requires</span> <span class="n">at</span> <span class="n">least</span> <span class="mi">3</span> <span class="n">columns</span><span class="o">.</span>

      <span class="o">--</span><span class="n">bases</span>             <span class="n">The</span> <span class="n">total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">overlapping</span> <span class="n">bases</span> <span class="kn">from</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">bases</span><span class="o">-</span><span class="n">uniq</span>        <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">distinct</span> <span class="n">bases</span> <span class="kn">from</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span><span class="s1">&#39;s element covered by</span>
                            <span class="n">overlapping</span> <span class="n">elements</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">bases</span><span class="o">-</span><span class="n">uniq</span><span class="o">-</span><span class="n">f</span>      <span class="n">The</span> <span class="n">fraction</span> <span class="n">of</span> <span class="n">distinct</span> <span class="n">bases</span> <span class="kn">from</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span><span class="s1">&#39;s element covered by</span>
                            <span class="n">overlapping</span> <span class="n">elements</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">count</span>             <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">overlapping</span> <span class="n">elements</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">echo</span>              <span class="n">Print</span> <span class="n">each</span> <span class="n">line</span> <span class="kn">from</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="nb">map</span>          <span class="n">List</span> <span class="nb">all</span> <span class="n">overlapping</span> <span class="n">elements</span> <span class="kn">from</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="nb">id</span>       <span class="n">List</span> <span class="n">IDs</span> <span class="kn">from</span> <span class="nn">all</span> <span class="n">overlapping</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">elements</span><span class="o">.</span>
      <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="nb">id</span><span class="o">-</span><span class="n">uniq</span>  <span class="n">List</span> <span class="n">unique</span> <span class="n">IDs</span> <span class="kn">from</span> <span class="nn">overlapping</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">elements</span><span class="o">.</span>
      <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="nb">range</span>    <span class="n">Print</span> <span class="n">genomic</span> <span class="nb">range</span> <span class="n">of</span> <span class="n">overlapping</span> <span class="n">elements</span> <span class="kn">from</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="n">score</span>    <span class="n">List</span> <span class="n">scores</span> <span class="kn">from</span> <span class="nn">overlapping</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">elements</span><span class="o">.</span>
      <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="n">size</span>     <span class="n">List</span> <span class="n">the</span> <span class="n">full</span> <span class="n">length</span> <span class="n">of</span> <span class="n">every</span> <span class="n">overlapping</span> <span class="n">element</span><span class="o">.</span>
      <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="n">overlap</span><span class="o">-</span><span class="n">size</span> <span class="n">List</span> <span class="n">lengths</span> <span class="n">of</span> <span class="n">overlaps</span><span class="o">.</span>
      <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="n">ref</span><span class="o">-</span><span class="n">name</span>     <span class="n">Print</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">3</span> <span class="n">fields</span> <span class="n">of</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">using</span> <span class="n">chrom</span><span class="p">:</span><span class="n">start</span><span class="o">-</span><span class="n">end</span> <span class="nb">format</span><span class="o">.</span>
      <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="n">ref</span><span class="o">-</span><span class="n">row</span><span class="o">-</span><span class="nb">id</span>   <span class="n">Print</span> <span class="s1">&#39;id-&#39;</span> <span class="n">followed</span> <span class="n">by</span> <span class="n">the</span> <span class="n">line</span> <span class="n">number</span> <span class="n">of</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">echo</span><span class="o">-</span><span class="n">ref</span><span class="o">-</span><span class="n">size</span>     <span class="n">Print</span> <span class="n">the</span> <span class="n">length</span> <span class="n">of</span> <span class="n">each</span> <span class="n">line</span> <span class="kn">from</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;.</span>
      <span class="o">--</span><span class="n">indicator</span>         <span class="n">Print</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">there</span> <span class="n">exists</span> <span class="n">an</span> <span class="n">overlapping</span> <span class="n">element</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="nb">map</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span><span class="p">,</span> <span class="mi">0</span> <span class="n">otherwise</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="operations">
<span id="bedmap-operations"></span><h2>6.2.1.3. Operations<a class="headerlink" href="#operations" title="Permalink to this headline">¶</a></h2>
<p>To demonstrate the various operations in <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a>, we start with two simple, pre-sorted BED files that we label as <code class="docutils literal notranslate"><span class="pre">Map</span></code> and <code class="docutils literal notranslate"><span class="pre">Reference</span></code> (see the <a class="reference internal" href="#bedmap-downloads"><span class="std std-ref">Downloads</span></a> section for files you can use to follow along).</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">Map</span></code> file is a snippet of real-world BED data derived from <a class="reference external" href="http://www.uwencode.org/">ENCODE</a> experiments conducted by our lab: specifically, raw <a class="reference external" href="http://en.wikipedia.org/wiki/Hypersensitive_site">DNaseI hypersensitivity</a> signal for the human K562 cell line (region <code class="docutils literal notranslate"><span class="pre">chr21:33031165-33032485</span></code>, assembly <code class="docutils literal notranslate"><span class="pre">GRCh37/h19</span></code> and table <code class="docutils literal notranslate"><span class="pre">wgEncodeUwDnaseK562RawRep1</span></code> from the <a class="reference external" href="http://genome.ucsc.edu/">UCSC Genome Browser</a>).</p>
<p>This raw signal is the density of sequence tags which map within a 150 bp sliding window, at 20 bp steps across the genome—a smoothed picture of DNaseI hypersensitivity:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chr21</span>   <span class="mi">33031165</span>        <span class="mi">33031185</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">1</span>   <span class="mf">1.000000</span>
<span class="n">chr21</span>   <span class="mi">33031185</span>        <span class="mi">33031205</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">2</span>   <span class="mf">3.000000</span>
<span class="n">chr21</span>   <span class="mi">33031205</span>        <span class="mi">33031225</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">3</span>   <span class="mf">3.000000</span>
<span class="n">chr21</span>   <span class="mi">33031225</span>        <span class="mi">33031245</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">4</span>   <span class="mf">3.000000</span>
<span class="n">chr21</span>   <span class="mi">33031245</span>        <span class="mi">33031265</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">5</span>   <span class="mf">3.000000</span>
<span class="n">chr21</span>   <span class="mi">33031265</span>        <span class="mi">33031285</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">6</span>   <span class="mf">5.000000</span>
<span class="n">chr21</span>   <span class="mi">33031285</span>        <span class="mi">33031305</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">7</span>   <span class="mf">7.000000</span>
<span class="n">chr21</span>   <span class="mi">33031305</span>        <span class="mi">33031325</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">8</span>   <span class="mf">7.000000</span>
<span class="n">chr21</span>   <span class="mi">33031325</span>        <span class="mi">33031345</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">9</span>   <span class="mf">8.000000</span>
<span class="n">chr21</span>   <span class="mi">33031345</span>        <span class="mi">33031365</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">14.000000</span>
<span class="n">chr21</span>   <span class="mi">33031365</span>        <span class="mi">33031385</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">11</span>  <span class="mf">15.000000</span>
<span class="n">chr21</span>   <span class="mi">33031385</span>        <span class="mi">33031405</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">12</span>  <span class="mf">17.000000</span>
<span class="n">chr21</span>   <span class="mi">33031405</span>        <span class="mi">33031425</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">13</span>  <span class="mf">17.000000</span>
<span class="o">...</span>
<span class="n">chr21</span>   <span class="mi">33032425</span>        <span class="mi">33032445</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">64</span>  <span class="mf">5.000000</span>
<span class="n">chr21</span>   <span class="mi">33032445</span>        <span class="mi">33032465</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">65</span>  <span class="mf">5.000000</span>
<span class="n">chr21</span>   <span class="mi">33032465</span>        <span class="mi">33032485</span>        <span class="nb">map</span><span class="o">-</span><span class="mi">66</span>  <span class="mf">6.000000</span>
</pre></div>
</div>
<p>When visualized, the signal data has the following appearance:</p>
<a class="reference internal image-reference" href="../../../_images/reference_bedmap_mapref_all.png"><img alt="../../../_images/reference_bedmap_mapref_all.png" src="../../../_images/reference_bedmap_mapref_all.png" style="width: 99%;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Rectangles colored in grey represent each of the sixty-six <code class="docutils literal notranslate"><span class="pre">map</span></code> elements. The x-axis represents the start coordinate of the <code class="docutils literal notranslate"><span class="pre">map</span></code> element, while the y-axis denotes the tag density, or sum of tags over that element’s 20-base window.</p>
</div>
<p>Our sample <code class="docutils literal notranslate"><span class="pre">Reference</span></code> file is not as exciting. It is just three BED elements which span portions of this density file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chr21</span>   <span class="mi">33031200</span>    <span class="mi">33032400</span>    <span class="n">ref</span><span class="o">-</span><span class="mi">1</span>
<span class="n">chr21</span>   <span class="mi">33031400</span>    <span class="mi">33031800</span>    <span class="n">ref</span><span class="o">-</span><span class="mi">2</span>
<span class="n">chr21</span>   <span class="mi">33031900</span>    <span class="mi">33032000</span>    <span class="n">ref</span><span class="o">-</span><span class="mi">3</span>
</pre></div>
</div>
<p>These reference elements could be exons, promoter regions, etc. It doesn’t matter for purposes of demonstration here, except to say that we can use <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> to ask some questions about the <code class="docutils literal notranslate"><span class="pre">Reference</span></code> set.</p>
<p>Among them, what are the quantitative and qualitative features of the <code class="docutils literal notranslate"><span class="pre">map</span></code> elements that span over these three reference regions? For example, we might want to know the mean DNase hypersensitivity across each—the answer may have some biological significance.</p>
<p>It may help to first visualize the reference regions and the mapped elements associated with them. A default <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> task will operate on the following set of mapped (red-colored) elements, for each reference element <code class="docutils literal notranslate"><span class="pre">ref-1</span></code>, <code class="docutils literal notranslate"><span class="pre">-2</span></code> and <code class="docutils literal notranslate"><span class="pre">-3</span></code>.</p>
<p>Here we show elements from the <code class="docutils literal notranslate"><span class="pre">Map</span></code> set which overlap the <code class="docutils literal notranslate"><span class="pre">ref-1</span></code> region <code class="docutils literal notranslate"><span class="pre">chr21:33031200-33032400</span></code>, colored in red:</p>
<a class="reference internal image-reference" href="../../../_images/reference_bedmap_mapref_ref1.png"><img alt="../../../_images/reference_bedmap_mapref_ref1.png" src="../../../_images/reference_bedmap_mapref_ref1.png" style="width: 99%;" /></a>
<p>Likewise, here are elements of the <code class="docutils literal notranslate"><span class="pre">Map</span></code> set which overlap the <code class="docutils literal notranslate"><span class="pre">ref-2</span></code> element <code class="docutils literal notranslate"><span class="pre">chr21:33031400-33031800</span></code> and <code class="docutils literal notranslate"><span class="pre">ref-3</span></code> element <code class="docutils literal notranslate"><span class="pre">chr21:33031900-33032000</span></code>, respectively, with the same coloring applied:</p>
<a class="reference internal image-reference" href="../../../_images/reference_bedmap_mapref_ref2.png"><img alt="../../../_images/reference_bedmap_mapref_ref2.png" src="../../../_images/reference_bedmap_mapref_ref2.png" style="width: 99%;" /></a>
<a class="reference internal image-reference" href="../../../_images/reference_bedmap_mapref_ref3.png"><img alt="../../../_images/reference_bedmap_mapref_ref3.png" src="../../../_images/reference_bedmap_mapref_ref3.png" style="width: 99%;" /></a>
<p>In these sample files, we provide the <code class="docutils literal notranslate"><span class="pre">Map</span></code> file with ID and score columns, and the <code class="docutils literal notranslate"><span class="pre">Reference</span></code> file with an ID column. These extra columns are not required by <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a>, but we can use the information in these columns in conjunction with the options provided by <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> to identify matches, retrieve matched signals, and summarize data about signal across mapped elements.</p>
<div class="section" id="overlap-criteria">
<span id="bedmap-overlap-criteria"></span><h3>6.2.1.3.1. Overlap criteria<a class="headerlink" href="#overlap-criteria" title="Permalink to this headline">¶</a></h3>
<p>The default overlap criterion that <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> uses is <em>one base</em>. That is, one or more bases of overlap between reference and mapping elements is sufficient for inclusion in operations. This value can be adjusted with the <code class="docutils literal notranslate"><span class="pre">--bp-ovr</span></code> option. The <code class="docutils literal notranslate"><span class="pre">--range</span></code> overlap option implicitly applies <code class="docutils literal notranslate"><span class="pre">--bp-ovr</span> <span class="pre">1</span></code> after symmetrically padding elements.</p>
<p>If a fractional overlap is desired, the <code class="docutils literal notranslate"><span class="pre">--fraction-{ref,map,both,either}</span></code> options provide the ability to filter on overlap by a specified percentage of the length of either or both the reference and mapping elements.</p>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">--exact</span></code> flag enforces exact matches between reference and mapping elements.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">--exact</span></code> option is an alias for <code class="docutils literal notranslate"><span class="pre">--fraction-both</span> <span class="pre">1</span></code>.</p>
</div>
<div class="section" id="using-faster-with-bp-ovr-fraction-both-exact-or-range">
<h4>6.2.1.3.1.1. Using <code class="docutils literal notranslate"><span class="pre">--faster</span></code> with <code class="docutils literal notranslate"><span class="pre">--bp-ovr</span></code>, <code class="docutils literal notranslate"><span class="pre">--fraction-both</span></code>, <code class="docutils literal notranslate"><span class="pre">--exact</span></code> or <code class="docutils literal notranslate"><span class="pre">--range</span></code><a class="headerlink" href="#using-faster-with-bp-ovr-fraction-both-exact-or-range" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">--faster</span></code> modifier works with the <code class="docutils literal notranslate"><span class="pre">--bp-ovr</span></code>, <code class="docutils literal notranslate"><span class="pre">--fraction-both</span></code> and <code class="docutils literal notranslate"><span class="pre">--exact</span></code> (<code class="docutils literal notranslate"><span class="pre">--fraction-both</span> <span class="pre">1</span></code>) overlap and <code class="docutils literal notranslate"><span class="pre">--range</span></code> specifiers to dramatically increase the performance of <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a>, when the following input restriction is met:</p>
<ul class="simple">
<li>No <a class="reference internal" href="../set-operations/nested-elements.html#nested-elements"><span class="std std-ref">fully-nested elements</span></a> in any input mapping file (duplicate elements and other overlapping elements are okay).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The details of this restriction are explained in more detail in the <a class="reference internal" href="../set-operations/nested-elements.html#nested-elements"><span class="std std-ref">nested element documentation</span></a>.</p>
</div>
<p>This option also works with the <code class="docutils literal notranslate"><span class="pre">--ec</span></code> error checking flag, which indicates if the data contain nested elements. Using <code class="docutils literal notranslate"><span class="pre">--ec</span></code> carries its usual overhead, but as it only doubles the much-improved execution time, it may be worth using.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>To give an idea of the speed improvement, a <code class="docutils literal notranslate"><span class="pre">--range</span> <span class="pre">100000</span> <span class="pre">--echo</span> <span class="pre">--count</span></code> operation on 8.4 million, non-nested mapping elements (DNaseI footprints across multiple cell types) took <em>2 minutes and 55 seconds</em> without speed-up. By adding the <code class="docutils literal notranslate"><span class="pre">--faster</span></code> flag, the same calculation took <em>10 seconds</em>. That is an <strong>18-fold</strong> speed improvement.</p>
<p>One scenario where this option can provide great speed gains is where <code class="docutils literal notranslate"><span class="pre">--range</span></code> is used with a large numerical parameter. Another scenario where this option is very useful is where the reference file has large elements, and the mapping file is made up of many small elements—specifically, where a number of small elements overlap each big element from the reference file.</p>
<p>An example of a research application for our lab which benefits from this flag is where we perform statistical analysis of large numbers of small sequence tags that fall in hotspot regions.</p>
<p class="last">If your data meet the <a class="reference internal" href="../set-operations/nested-elements.html#nested-elements"><span class="std std-ref">non-nesting criteria</span></a>, using <code class="docutils literal notranslate"><span class="pre">--faster</span></code> with <code class="docutils literal notranslate"><span class="pre">--bp-ovr</span></code>, <code class="docutils literal notranslate"><span class="pre">--fraction-both</span></code>, <code class="docutils literal notranslate"><span class="pre">--exact</span></code> or <code class="docutils literal notranslate"><span class="pre">--range</span></code> is <em>highly recommended</em>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Our lab works with BED data of various types: cut-counts, hotspots, peaks, footprints, etc. These data generally do not contain nested elements and so are amenable to use with <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap’s</span></a> <code class="docutils literal notranslate"><span class="pre">--faster</span></code> flag for extracting overlapping elements.</p>
<p>However, other types of data can be problematic. <a class="reference external" href="http://meme.nbcr.net/meme/fimo-intro.html">FIMO</a> search results, for example, may cause trouble, where the boundaries of one motif hit can be contained within another larger hit. Or paired-end sequence data, where tags are not of a fixed length.</p>
<p class="last">Be sure to consider the makeup of your BED data before using <code class="docutils literal notranslate"><span class="pre">--faster</span></code>.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Using <code class="docutils literal notranslate"><span class="pre">--ec</span></code> with <code class="docutils literal notranslate"><span class="pre">--faster</span></code> will report if any nested elements exist in your data.</p>
</div>
</div>
</div>
<div class="section" id="score-operations">
<span id="bedmap-score-operations"></span><h3>6.2.1.3.2. Score operations<a class="headerlink" href="#score-operations" title="Permalink to this headline">¶</a></h3>
<p>Score operators apply a numerical calculation on the values of the score column of mapping elements. Per <a class="reference external" href="http://genome.ucsc.edu/FAQ/FAQformat.html#format1">UCSC specifications</a>, <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> assumes the score data are stored in the fifth column.</p>
<p>The variety of score operators include common statistical measures:</p>
<ul class="simple">
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Expected_value">mean</a> (<code class="docutils literal notranslate"><span class="pre">--mean</span></code>)</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Truncated_mean">trimmed mean</a> (<code class="docutils literal notranslate"><span class="pre">--tmean</span></code>)</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Weighted_arithmetic_mean">weighted mean</a> (<code class="docutils literal notranslate"><span class="pre">--wmean</span></code>)</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Standard_deviation">standard deviation</a> (<code class="docutils literal notranslate"><span class="pre">--stdev</span></code>)</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Variance">variance</a> (<code class="docutils literal notranslate"><span class="pre">--variance</span></code>)</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Coefficient_of_variation">coefficient of variance</a> (<code class="docutils literal notranslate"><span class="pre">--cv</span></code>)</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Median">median</a> (<code class="docutils literal notranslate"><span class="pre">--median</span></code>)</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Median_absolute_deviation">median absolute deviation</a> (<code class="docutils literal notranslate"><span class="pre">--mad</span></code>)</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Order_statistic">k-th order statistic</a> (<code class="docutils literal notranslate"><span class="pre">--kth</span></code>)</li>
</ul>
<p>One can also take the sum of scores (<code class="docutils literal notranslate"><span class="pre">--sum</span></code>), find the minimum or maximum score over a region (<code class="docutils literal notranslate"><span class="pre">--min</span></code> and <code class="docutils literal notranslate"><span class="pre">--max</span></code>, respectively), or retrieve the map element with the least or greatest signal over the reference region (<code class="docutils literal notranslate"><span class="pre">--min-element</span></code> and <code class="docutils literal notranslate"><span class="pre">--max-element</span></code>, respectively).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Map input should not contain spaces in the ID or in subsequent fields. Running <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> with <code class="code docutils literal notranslate"><span class="pre">--ec</span></code> will identify problematic input. Spaces in these fields will cause problems with <code class="code docutils literal notranslate"><span class="pre">--min-element</span></code>, <code class="code docutils literal notranslate"><span class="pre">--max-element</span></code>, and other options that require parsing of the fourth and subsequent columns of the map input.</p>
<p class="last">An <code class="code docutils literal notranslate"><span class="pre">awk</span></code> script can help with translating ID spaces to another non-whitespace delimiter, <em>e.g.</em>, <code class="code docutils literal notranslate"><span class="pre">bedmap</span> <span class="pre">(--options...)</span> <span class="pre">reference.bed</span> <span class="pre">&lt;(awk</span> <span class="pre">-vOFS=&quot;\t&quot;</span> <span class="pre">-vFS=&quot;\t&quot;</span> <span class="pre">'{gsub(&quot;</span> <span class="pre">&quot;,</span> <span class="pre">&quot;%%&quot;,</span> <span class="pre">$4);</span> <span class="pre">print;}'</span> <span class="pre">map.bed)</span></code> and then <cite>awk -vOFS=”t” -vFS=”t” ‘{gsub(“%%”, ” “); print;}’ result.bed</cite> to convert delimiters back to spaces.</p>
</div>
<p>We will demonstrate some of these operators by applying them to the <code class="docutils literal notranslate"><span class="pre">Reference</span></code> and <code class="docutils literal notranslate"><span class="pre">Map</span></code> datasets (see the <a class="reference internal" href="#bedmap-downloads"><span class="std std-ref">Downloads</span></a> section for sample inputs).</p>
<p>As a reminder, the <code class="docutils literal notranslate"><span class="pre">Map</span></code> file contains regions of DNaseI-seq tag density. If we want the mean of the density across <cite>Reference</cite> elements, we use the <code class="docutils literal notranslate"><span class="pre">--mean</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --echo --mean reference.bed map.bed &gt; mappedReferences.mean.bed
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--echo</span></code> flag prints each <code class="docutils literal notranslate"><span class="pre">Reference</span></code> element, while the <code class="docutils literal notranslate"><span class="pre">--mean</span></code> flag calculates the mean signal of the <code class="docutils literal notranslate"><span class="pre">Map</span></code> elements which overlap the reference element:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ more mappedReferences.mean.bed
chr21   33031200    33032400    ref-1|43.442623
chr21   33031400    33031800    ref-2|31.571429
chr21   33031900    33032000    ref-3|154.500000
</pre></div>
</div>
<p>This result tells us that the mean density across regions <code class="docutils literal notranslate"><span class="pre">ref-1</span></code>, <code class="docutils literal notranslate"><span class="pre">ref-2</span></code> and <code class="docutils literal notranslate"><span class="pre">ref-3</span></code> is <code class="docutils literal notranslate"><span class="pre">44.442623</span></code>, <code class="docutils literal notranslate"><span class="pre">31.571429</span></code> and <code class="docutils literal notranslate"><span class="pre">154.5</span></code>, respectively.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The pipe character (<code class="docutils literal notranslate"><span class="pre">|</span></code>) delimits the results of each specified option (with the exception of the so-called “multi” operators that return multiple results — this is discussed in the section on <code class="docutils literal notranslate"><span class="pre">--echo</span></code> flags). In the provided example, the delimiter divides the reference element from the mean score across the reference element.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Because we used the <code class="docutils literal notranslate"><span class="pre">--echo</span></code> flag in this example, we are guaranteed output that is at least three-column BED format and which is <a class="reference internal" href="../file-management/sorting/sort-bed.html#sort-bed"><span class="std std-ref">sorted</span></a>, which can be useful for <a class="reference external" href="http://en.wikipedia.org/wiki/Pipeline_(Unix)">pipeline</a> design, where results are piped downstream to <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a>, <a class="reference internal" href="../set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> and other BEDOPS and UNIX utilities.</p>
</div>
<p>If we simply want the mean values and don’t care about the reference data, we can skip <code class="docutils literal notranslate"><span class="pre">--echo</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --mean reference.bed map.bed
43.442623
31.571429
154.500000
</pre></div>
</div>
<p>While not very detailed, this single-column representation can be useful for those who use UNIX utilities like <code class="docutils literal notranslate"><span class="pre">paste</span></code> or need to do additional downstream calculations with <code class="docutils literal notranslate"><span class="pre">R</span></code> or other utilities, where the reference information is unnecessary (or, at least, more work to excise).</p>
<p>If a reference element does not overlap any map element, then a <code class="docutils literal notranslate"><span class="pre">NAN</span></code> is returned for any operation on that entry, <em>e.g.</em>, we know that the <em>ad hoc</em> element <code class="docutils literal notranslate"><span class="pre">chr21:1000-2000</span></code> does not overlap any member of our <code class="docutils literal notranslate"><span class="pre">Map</span></code> dataset, and there is therefore no mean value that can be calculated for that element:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr21\t1000\t2000\tfoo-1&quot; | bedmap --echo --mean - map.bed
chr21   1000    2000    foo-1|NAN
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>For this example, we use <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">-e</span></code> to send <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> a sample reference coordinate by way of standard input. The <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> program can process any BED data from the standard input stream, either as the reference or map data, by placing the dash character (<code class="docutils literal notranslate"><span class="pre">-</span></code>) where the file name would otherwise go.</p>
<p>In the example above, we sent <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> a single reference element via standard input, but multiple lines of BED data can come from other upstream processes.</p>
<p class="last">Using <a class="reference external" href="http://en.wikipedia.org/wiki/Pipeline_(Unix)">standard streams</a> is useful for reducing file I/O and improving performance, especially in situations where one is using <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> in the middle of an extended pipeline.</p>
</div>
<p>While <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> returns a <code class="docutils literal notranslate"><span class="pre">NAN</span></code> if there are no mapped elements that associate with a reference element, we may want to filter these lines out. We can apply the <code class="docutils literal notranslate"><span class="pre">--skip-unmapped</span></code> option to leave out reference elements without mapped elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr21\t1000\t2000\tfoo-1&quot; | bedmap --echo --mean --skip-unmapped - map.bed
$
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Some operations may yield a reference element with one or more mapped elements, which still return a <code class="docutils literal notranslate"><span class="pre">NAN</span></code> value by virtue of the calculation result. The <code class="docutils literal notranslate"><span class="pre">--skip-unmapped</span></code> operand will still allow these reference elements to be printed out!</p>
<p>For instance, consider the <code class="docutils literal notranslate"><span class="pre">--variance</span></code> operator, which requires two or more map elements to calculate a variance. Where there is only one mapped element associated with the reference element, a <code class="docutils literal notranslate"><span class="pre">--variance</span></code> calculation will return a <code class="docutils literal notranslate"><span class="pre">NAN</span></code>. In this case, <code class="docutils literal notranslate"><span class="pre">--skip-unmapped</span></code> will still print this element, even though the result is <code class="docutils literal notranslate"><span class="pre">NAN</span></code>.</p>
<p>Given the following statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --skip-unmapped --variance file1 file2
</pre></div>
</div>
<p>This is functionally equivalent to the following statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --indicator --variance --delim &quot;\t&quot; file1 file2 | awk &#39;($1==1) {print $2}&#39;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--indicator</span></code> operand calculates whether there are any mapped elements (or none)—see the <a class="reference internal" href="#bedmap-indicator"><span class="std std-ref">indicator</span></a> section for more detail. The <code class="docutils literal notranslate"><span class="pre">awk</span></code> statement then prints results which have one or more mapped elements, effectively filtering unmapped references.</p>
<p class="last">It should therefore be more convenient to use <code class="docutils literal notranslate"><span class="pre">--skip-unmapped</span></code> where unmapped reference elements are not needed.</p>
</div>
<p>Another option is to retrieve the mapping element with the highest or lowest score within the reference region, using the <code class="docutils literal notranslate"><span class="pre">--max-element</span></code> or <code class="docutils literal notranslate"><span class="pre">--min-element</span></code> operators, respectively.</p>
<p>Going back to our sample <code class="docutils literal notranslate"><span class="pre">Reference</span></code> and <code class="docutils literal notranslate"><span class="pre">Map</span></code> data, we can search for the highest scoring mapping elements across the three reference elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --echo --max-element --prec 0 reference.bed map.bed
chr21   33031200        33032400        ref-1|chr21     33031885        33031905        map-37  165
chr21   33031400        33031800        ref-2|chr21     33031785        33031805        map-32  82
chr21   33031900        33032000        ref-3|chr21     33031885        33031905        map-37  165
</pre></div>
</div>
<p>Over reference elements <code class="docutils literal notranslate"><span class="pre">ref-1</span></code> and <code class="docutils literal notranslate"><span class="pre">ref-3</span></code>, the mapping element <code class="docutils literal notranslate"><span class="pre">map-37</span></code> has the highest score. Over reference element <code class="docutils literal notranslate"><span class="pre">ref-2</span></code>, the highest scoring mapping element is <code class="docutils literal notranslate"><span class="pre">map-32</span></code>.</p>
<p>Likewise, we can repeat this operation, but look for the lowest scoring elements, instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --echo --min-element --prec 0 reference.bed map.bed
chr21   33031200        33032400        ref-1|chr21     33032265        33032285        map-56  2
chr21   33031400        33031800        ref-2|chr21     33031525        33031545        map-19  13
chr21   33031900        33032000        ref-3|chr21     33031985        33032005        map-42  138
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Where there are ties in score values, using <code class="docutils literal notranslate"><span class="pre">--max-element</span></code> or <code class="docutils literal notranslate"><span class="pre">--min-element</span></code> now selects the lexicographically smallest element amongst the set of tied elements. This generally means that the first element in the lexicographic ordering of the ID fields (fourth column) will determine the selection.</p>
<p class="last">A random selection process was used for <code class="docutils literal notranslate"><span class="pre">--max-element</span></code> and <code class="docutils literal notranslate"><span class="pre">--min-element</span></code> in versions 2.4.20 and previous. If you wish to randomly sample a maximum- or minimum-scoring element from amongst tied elements (say, to reproduce the procedure of prior analyses), you may use the <code class="docutils literal notranslate"><span class="pre">--max-element-rand</span></code> or <code class="docutils literal notranslate"><span class="pre">--min-element-rand</span></code> options, respectively.</p>
</div>
<p>We can also perform multiple score operations, which are summarized on one line, <em>e.g.</em>, to show the mean, standard deviation, and minimum and maximum signal over each <code class="docutils literal notranslate"><span class="pre">Reference</span></code> element, we simply add the requisite options in series:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --echo --mean --stdev --min --max reference.bed map.bed
chr21   33031200    33032400    ref-1|43.442623|50.874527|2.000000|165.000000
chr21   33031400    33031800    ref-2|31.571429|19.638155|13.000000|82.000000
chr21   33031900    33032000    ref-3|154.500000|9.311283|138.000000|165.000000
</pre></div>
</div>
<p>Multiple score-operational results are ordered identically with the command-line options. The section on <a class="reference internal" href="#bedmap-formatting-score-output"><span class="std std-ref">formatting score output</span></a> demonstrates how one can change the precision and general format of numerical score results.</p>
</div>
<div class="section" id="non-score-operations">
<span id="bedmap-non-score-operations"></span><h3>6.2.1.3.3. Non-score operations<a class="headerlink" href="#non-score-operations" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it is useful to get summary or non-score statistics about the map elements. This category of operators returns information from the ID column of mapping elements, or can return counts and base overlap totals.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As with score data, we follow the <a class="reference external" href="http://genome.ucsc.edu/FAQ/FAQformat.html#format1">UCSC convention</a> for the BED format and retrieve ID data from the fourth column.</p>
</div>
<div class="section" id="echo">
<span id="bedmap-echo"></span><h4>6.2.1.3.3.1. Echo<a class="headerlink" href="#echo" title="Permalink to this headline">¶</a></h4>
<p>The ID, score and coordinate columns of the reference and map files are very useful for reading and debugging results, or reporting a more detailed mapping.</p>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">--echo</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-map</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-map-id</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-map-id-uniq</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-map-score</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-map-range</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-map-size</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-overlap-size</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-ref-name</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-ref-row-id</span></code>, and <code class="docutils literal notranslate"><span class="pre">echo-ref-size</span></code> flags to tell <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> to report additional details about the reference and map elements.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--echo</span></code> flag reports each reference element. We have already seen the application of <code class="docutils literal notranslate"><span class="pre">--echo</span></code> in earlier examples. The option helps to clearly associate results from other chosen operations with specific reference elements. Additionally, <code class="docutils literal notranslate"><span class="pre">--echo</span></code> enables the output from <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> to be used as input to additional BEDOPS utilities, including <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> itself.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--echo-map</span></code> flag gathers overlapping mapped elements for every reference element. The option is useful for debugging and detailed downstream processing needs. This is the most general operation in <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> in that overlapping elements are returned in full detail, for every reference element. While results are well-defined and easily parsed, the output can be very large and difficult to read.</p>
<p>As an example of using the <code class="docutils literal notranslate"><span class="pre">--echo-map-id</span></code> operator in a biological context, we examine a <a class="reference external" href="http://meme.nbcr.net/meme/fimo-intro.html">FIMO</a> analysis that returns a subset of transcription factor binding sites in BED format, with <a class="reference external" href="http://en.wikipedia.org/wiki/TRANSFAC">TRANSFAC</a> motif names listed in the ID column:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chr1</span>    <span class="mi">4534161</span> <span class="mi">4534177</span> <span class="o">-</span><span class="n">V_GRE_C</span>        <span class="mf">4.20586e-06</span>     <span class="o">-</span>       <span class="n">CGTACACACAGTTCTT</span>
<span class="n">chr1</span>    <span class="mf">4534192.4</span><span class="o">.</span><span class="mi">364205</span> <span class="o">-</span><span class="n">V_STAT_Q6</span>      <span class="mf">2.21622e-06</span>     <span class="o">-</span>       <span class="n">AGCACTTCTGGGA</span>
<span class="n">chr1</span>    <span class="mi">4534209</span> <span class="mi">4534223</span> <span class="o">+</span><span class="n">V_HNF4_Q6_01</span>   <span class="mf">6.93604e-06</span>     <span class="o">+</span>       <span class="n">GGACCAGAGTCCAC</span>
<span class="n">chr1</span>    <span class="mf">4962522.4</span><span class="o">.</span><span class="mi">362540</span> <span class="o">-</span><span class="n">V_GCNF_01</span>      <span class="mf">9.4497e-06</span>      <span class="o">-</span>       <span class="n">CCCAAGGTCAAGATAAAG</span>
<span class="n">chr1</span>    <span class="mi">4962529</span> <span class="mi">4962539</span> <span class="o">+</span><span class="n">V_NUR77_Q5</span>     <span class="mf">8.43564e-06</span>     <span class="o">+</span>       <span class="n">TTGACCTTGG</span>
<span class="o">...</span>
</pre></div>
</div>
<p>This input is available from the <a class="reference internal" href="#bedmap-downloads"><span class="std std-ref">Downloads</span></a> section as the <code class="docutils literal notranslate"><span class="pre">Motifs</span></code> dataset.</p>
<p>We will treat this as a map file, asking which motif IDs are associated with a region of interest (<code class="docutils literal notranslate"><span class="pre">chr1:4534150-4534300</span></code>). To do this using <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a>, we use the <code class="docutils literal notranslate"><span class="pre">--echo-map-id</span></code> option to summarize the IDs of mapped elements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr1\t4534150\t4534300\tref-1&quot; | bedmap --echo --echo-map-id - motifs.bed
chr1    4534150 4534300 ref-1|-V_GRE_C;-V_STAT_Q6;+V_HNF4_Q6_01
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To expand on the types of questions one can answer with <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> in this context, in conjunction with the <code class="docutils literal notranslate"><span class="pre">--count</span></code> operator (described below), one can quantify predicted transcription factor binding sites by sliding a reference window across the entire genome.</p>
<p class="last">One could determine, for example, where predicted sites are most prevalent and investigate the distribution of factors or other genomic features at or around these dense regions.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--echo-map-id-uniq</span></code> operator works exactly like <code class="docutils literal notranslate"><span class="pre">--echo-map-id</span></code>, except that duplicate IDs are removed from the result. For example, we can pull all the motifs hits from a wide region on <code class="docutils literal notranslate"><span class="pre">chr2</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr2\t1000\t10000000\tref-1&quot; | bedmap --echo --echo-map-id - motifs.bed
chr2    1000    10000000        ref-1|+V_OCT1_05;+V_OCT_C;-V_CACD_01;+V_IRF_Q6;-V_BLIMP1_Q6;-V_IRF2_01;-V_IRF_Q6_01;+V_SMAD_Q6_01;-V_TATA_01;-V_TATA_C;-V_CEBP_01;-V_HNF6_Q6;+V_MTF1_Q4;+V_MYOD_Q6_01;-V_KROX_Q6;+V_EGR1_01;-V_SP1SP3_Q4;+V_EGR_Q6;+V_SP1_Q6;-V_SP1_Q2_01;-V_CKROX_Q2;+V_SP1_Q6_01;-V_SREBP1_Q5;+V_VDR_Q3;-V_DMRT1_01;-V_DMRT7_01;+V_DMRT1_01;-V_DMRT1_01;-V_DMRT7_01;+V_DMRT1_01;-V_DMRT1_01;-V_DMRT7_01
</pre></div>
</div>
<p>However, some hits (<em>e.g.</em>, <code class="docutils literal notranslate"><span class="pre">-V_DMRT7_01</span></code>) show up two or more times. If we want a non-redundant list, we replace <code class="docutils literal notranslate"><span class="pre">--echo-map-id</span></code> with <code class="docutils literal notranslate"><span class="pre">--echo-map-id-uniq</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr2\t1000\t10000000\tref-1&quot; | bedmap --echo --echo-map-id-uniq - motifs.bed
chr2    1000    10000000        ref-1|+V_DMRT1_01;+V_EGR1_01;+V_EGR_Q6;+V_IRF_Q6;+V_MTF1_Q4;+V_MYOD_Q6_01;+V_OCT1_05;+V_OCT_C;+V_SMAD_Q6_01;+V_SP1_Q6;+V_SP1_Q6_01;+V_VDR_Q3;-V_BLIMP1_Q6;-V_CACD_01;-V_CEBP_01;-V_CKROX_Q2;-V_DMRT1_01;-V_DMRT7_01;-V_HNF6_Q6;-V_IRF2_01;-V_IRF_Q6_01;-V_KROX_Q6;-V_SP1SP3_Q4;-V_SP1_Q2_01;-V_SREBP1_Q5;-V_TATA_01;-V_TATA_C
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--echo-map-score</span></code> flag works in a similar fashion to <code class="docutils literal notranslate"><span class="pre">--echo-map-id</span></code>, reporting scores instead of IDs. The <a class="reference internal" href="#bedmap-formatting-score-output"><span class="std std-ref">formatting score output</span></a> section demonstrates how one can use <code class="docutils literal notranslate"><span class="pre">--echo-map-score</span></code> to summarize score data from mapped elements.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Both the <code class="docutils literal notranslate"><span class="pre">--echo-map-id</span></code> and <code class="docutils literal notranslate"><span class="pre">--echo-map-score</span></code> flags use the semi-colon (<code class="docutils literal notranslate"><span class="pre">;</span></code>) as a default delimiter, which may be changed with the <code class="docutils literal notranslate"><span class="pre">--multidelim</span></code> option (see the <a class="reference internal" href="#bedmap-delimiters"><span class="std std-ref">Delimiters</span></a> section for more information on this and other modifier operators).</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--echo-map-range</span></code> flag tells <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> to report the genomic range of overlapping mapped elements. If we apply this flag to the <code class="docutils literal notranslate"><span class="pre">Reference</span></code> and <code class="docutils literal notranslate"><span class="pre">Map</span></code> datasets (see <a class="reference internal" href="#bedmap-downloads"><span class="std std-ref">Downloads</span></a>), we get the following result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --echo --echo-map-range reference.bed map.bed
chr21   33031200    33032400    ref-1|chr21 33031185    33032405
chr21   33031400    33031800    ref-2|chr21 33031385    33031805
chr21   33031900    33032000    ref-3|chr21 33031885    33032005
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">--echo-map-range</span></code> option produces three-column BED results that are not always guaranteed to be sorted. The <code class="docutils literal notranslate"><span class="pre">--echo</span></code> operation is independent, and it produces reference elements in proper BEDOPS order, as shown. If the results of the <code class="docutils literal notranslate"><span class="pre">--echo-map-range</span></code> option will be used directly as BED coordinates in downstream BEDOPS analyses (<em>i.e.</em>, no <code class="docutils literal notranslate"><span class="pre">--echo</span></code> operator), first pipe them to <a class="reference internal" href="../file-management/sorting/sort-bed.html#sort-bed"><span class="std std-ref">sort-bed</span></a> to ensure proper sort order.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Map input should not contain spaces in the ID or in subsequent fields. Running <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> with <code class="code docutils literal notranslate"><span class="pre">--ec</span></code> will identify problematic input. Spaces in these fields will cause problems with <code class="code docutils literal notranslate"><span class="pre">--echo-map-id</span></code>, <code class="code docutils literal notranslate"><span class="pre">--echo-map-id-uniq</span></code>, and other options that require parsing of the fourth and subsequent columns of the map input.</p>
<p class="last">An <code class="code docutils literal notranslate"><span class="pre">awk</span></code> script can help with translating ID spaces to another non-whitespace delimiter, <em>e.g.</em>, <code class="code docutils literal notranslate"><span class="pre">bedmap</span> <span class="pre">(--options...)</span> <span class="pre">reference.bed</span> <span class="pre">&lt;(awk</span> <span class="pre">-vOFS=&quot;\t&quot;</span> <span class="pre">-vFS=&quot;\t&quot;</span> <span class="pre">'{gsub(&quot;</span> <span class="pre">&quot;,</span> <span class="pre">&quot;%%&quot;,</span> <span class="pre">$4);</span> <span class="pre">print;}'</span> <span class="pre">map.bed)</span></code> and then <cite>awk -vOFS=”t” -vFS=”t” ‘{gsub(“%%”, ” “); print;}’ result.bed</cite> to convert delimiters back to spaces.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--echo-ref-size</span></code> flag reports the difference between the stop and start coordinates of the reference element.  The <code class="docutils literal notranslate"><span class="pre">--echo-ref-name</span></code> flag produces a converted format for the first 3 BED fields, A:B-C, where A is the chromosome name, B is the start coordinate, and C is the stop coordinate for that reference element.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--echo-ref-row-id</span></code> flag prints the prefix <code class="docutils literal notranslate"><span class="pre">id-</span></code> with the line number of the reference element.</p>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">--echo-map-size</span></code> flag reports the difference between the stop and start coordinates of each mapped element, while the <code class="docutils literal notranslate"><span class="pre">--echo-overlap-size</span></code> flag reports the length of the overlap between the reference element and each mapped element.</p>
</div>
<div class="section" id="element-and-overlap-statistics">
<span id="bedmap-element-and-overlap-statistics"></span><h4>6.2.1.3.3.2. Element and overlap statistics<a class="headerlink" href="#element-and-overlap-statistics" title="Permalink to this headline">¶</a></h4>
<p>Looking back at the <code class="docutils literal notranslate"><span class="pre">Map</span></code> and <code class="docutils literal notranslate"><span class="pre">Reference</span></code> datasets, let’s say we want to count the number of elements in <code class="docutils literal notranslate"><span class="pre">Map</span></code> that overlap a given <code class="docutils literal notranslate"><span class="pre">Reference</span></code> element, as well as the extent of that overlap as measured by the total number of overlapping bases from mapped elements. For this, we use the <code class="docutils literal notranslate"><span class="pre">--count</span></code> and <code class="docutils literal notranslate"><span class="pre">--bases</span></code> flags, respectively:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --echo --count --bases reference.bed map.bed
chr21   33031200    33032400    ref-1|61|1200
chr21   33031400    33031800    ref-2|21|400
chr21   33031900    33032000    ref-3|6|100
</pre></div>
</div>
<p>This result tells us that there are 61 elements in <code class="docutils literal notranslate"><span class="pre">Map</span></code> that overlap <code class="docutils literal notranslate"><span class="pre">ref-1</span></code>, and 1200 total bases from the 61 elements overlap bases of <code class="docutils literal notranslate"><span class="pre">ref-1</span></code>. Similarly, 21 elements overlap <code class="docutils literal notranslate"><span class="pre">ref-2</span></code>, and 400 total bases from the 21 elements overlap bases of <code class="docutils literal notranslate"><span class="pre">ref-2</span></code>, etc.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--bases</span></code> operator works on <code class="docutils literal notranslate"><span class="pre">Map</span></code> elements. If, instead, we want to quantify the degree to which <code class="docutils literal notranslate"><span class="pre">Reference</span></code> elements overlap <code class="docutils literal notranslate"><span class="pre">Map</span></code> , we can use the <code class="docutils literal notranslate"><span class="pre">--bases-uniq</span></code> and <code class="docutils literal notranslate"><span class="pre">--bases-uniq-f</span></code> flags to count the number of bases and, respectively, the fraction of total bases within <code class="docutils literal notranslate"><span class="pre">Reference</span></code> which are covered by overlapping elements in <code class="docutils literal notranslate"><span class="pre">Map</span></code>.</p>
<p>This last example uses <code class="docutils literal notranslate"><span class="pre">Motifs</span></code> elements and all of the options: <code class="docutils literal notranslate"><span class="pre">--bases</span></code>, <code class="docutils literal notranslate"><span class="pre">--bases-uniq</span></code> and <code class="docutils literal notranslate"><span class="pre">--bases-uniq-f</span></code>, to illustrate their different behaviors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr1\t4534161\t4962550\tadhoc-1&quot; | bedmap --echo --bases --bases-uniq --bases-uniq-f - motifs.bed
chr1    4534161     4962550     adhoc-1|169|71|0.000166
</pre></div>
</div>
</div>
<div class="section" id="indicator">
<span id="bedmap-indicator"></span><h4>6.2.1.3.3.3. Indicator<a class="headerlink" href="#indicator" title="Permalink to this headline">¶</a></h4>
<p>If we simply want to know if a reference element overlaps one or more map elements, we can use the <code class="docutils literal notranslate"><span class="pre">--indicator</span></code> operator, which returns a <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code> value, depending on whether there is or is not an overlap, respectively. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --echo --indicator reference.bed map.bed
chr21   33031200    33032400    ref-1|1
chr21   33031400    33031800    ref-2|1
chr21   33031900    33032000    ref-3|1
</pre></div>
</div>
<p>All three of our reference elements have mapped elements associated with them. If we, instead, test a reference element that we know ahead of time does not contain overlapping map elements, we get a <code class="docutils literal notranslate"><span class="pre">0</span></code> result, as we expect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr21\t1000\t2000\tfoo-1&quot; | bedmap --echo --indicator - map.bed
chr21   1000    2000    foo-1|0
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--indicator</span></code> option is equivalent to testing if the result from <code class="docutils literal notranslate"><span class="pre">--count</span></code> is equal to or greater than <code class="docutils literal notranslate"><span class="pre">0</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --count foo bar | awk &#39;{ print ($1 &gt; 0 ? &quot;1&quot; : &quot;0&quot;) }&#39; -
</pre></div>
</div>
<p class="last">This option eliminates the need for piping <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> results to <code class="docutils literal notranslate"><span class="pre">awk</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="modifiers">
<span id="bedmap-modifier-operations"></span><h3>6.2.1.3.4. Modifiers<a class="headerlink" href="#modifiers" title="Permalink to this headline">¶</a></h3>
<p>These options can modify the coordinates used for generating the set of mapped regions, as well as alter the presentation of results. These modifiers can be useful, depending on how <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> is used in your own workflow.</p>
<div class="section" id="range">
<span id="bedmap-range"></span><h4>6.2.1.3.4.1. Range<a class="headerlink" href="#range" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">--range</span></code> option uses <code class="docutils literal notranslate"><span class="pre">--bp-ovr</span> <span class="pre">1</span></code> (<em>i.e.</em>, <a class="reference internal" href="#bedmap-overlap-criteria"><span class="std std-ref">one base of overlap</span></a>) after internally and symmetrically padding reference coordinates by a specified positive integer value. The larger reference elements are used to determine overlapping mapped elements, prior to applying chosen operations.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">To change the coordinates of a BED file on <em>output</em> (symmetrically or asymmetrically), see the <code class="docutils literal notranslate"><span class="pre">--range</span></code> option applied with <a class="reference internal" href="../set-operations/bedops.html#bedops-range"><span class="std std-ref">bedops –everything</span></a>.</p>
</div>
<p>As an example, we look again at element <code class="docutils literal notranslate"><span class="pre">ref-3</span></code> from the <code class="docutils literal notranslate"><span class="pre">Reference</span></code> dataset and where it overlaps with <code class="docutils literal notranslate"><span class="pre">Map</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chr21</span>   <span class="mi">33031900</span>    <span class="mi">33032000</span>    <span class="n">ref</span><span class="o">-</span><span class="mi">3</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/reference_bedmap_mapref_ref3.png"><img alt="../../../_images/reference_bedmap_mapref_ref3.png" src="../../../_images/reference_bedmap_mapref_ref3.png" style="width: 99%;" /></a>
<p>If we want to apply an operation on 100 bp upstream and downstream of this and the other reference elements, we can use the <code class="docutils literal notranslate"><span class="pre">--range</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --echo --echo-map-id --range 100 reference.bed map.bed &gt; mappedReference.padded.bed
</pre></div>
</div>
<p>Any operation will now be applied to a broader set of mapped elements, as visualized here with a “padded” version of <code class="docutils literal notranslate"><span class="pre">ref-3</span></code>:</p>
<a class="reference internal image-reference" href="../../../_images/reference_bedmap_mapref_ref3_padded.png"><img alt="../../../_images/reference_bedmap_mapref_ref3_padded.png" src="../../../_images/reference_bedmap_mapref_ref3_padded.png" style="width: 99%;" /></a>
<p>We can compare mean densities, in order to see the effect of using <code class="docutils literal notranslate"><span class="pre">--range</span></code>. Here is the mean density across the original, unpadded <code class="docutils literal notranslate"><span class="pre">ref-3</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --echo --mean reference.bed map.bed
...
chr21   33031900    33032000    ref-3|154.500000
</pre></div>
</div>
<p>And here is the mean density across the padded <code class="docutils literal notranslate"><span class="pre">ref-3</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --echo --range 100 --mean reference.bed map.bed
...
chr21   33031900    33032000    ref-3|117.750000
</pre></div>
</div>
<p>Looking at the visualizations above, we would expect the mean density to be lower, as the expanded reference region includes map elements with lower tag density, which pushes down the overall mean.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">--range</span></code> option is classified as an overlap option (like <code class="docutils literal notranslate"><span class="pre">--fraction-map</span></code> or <code class="docutils literal notranslate"><span class="pre">--exact</span></code>) that implicitly uses <code class="docutils literal notranslate"><span class="pre">--bp-ovr</span> <span class="pre">1</span></code> after padding reference elements. As shown above, the extended padding is an internal operation and it is not reflected in the output with the <code class="docutils literal notranslate"><span class="pre">--echo</span></code> option. Real padding can be added by using <code class="docutils literal notranslate"><span class="pre">bedops</span> <span class="pre">--range</span> <span class="pre">100</span> <span class="pre">--everything</span> <span class="pre">reference.bed</span></code> and piping results to <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Because <code class="docutils literal notranslate"><span class="pre">--range</span></code> is an internal operation, some statistical operations like <code class="docutils literal notranslate"><span class="pre">--bases</span></code> and <code class="docutils literal notranslate"><span class="pre">--bases-uniq</span></code> do not work as one might expect.</p>
<p>As an example, we might want to count the number of overlapping, unique bases between a 1000-base window around a reference element and a set of mapped elements. The following command will not work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedmap --echo --range 1000 --bases-uniq reference.bed map.bed
</pre></div>
</div>
<p>Instead, use <a class="reference internal" href="../set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> to build the window, piping it into a downstream <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> command. The result of this operation can be piped into the core utility <code class="docutils literal notranslate"><span class="pre">paste</span></code> with the original reference set, in order to associate reference elements with the windowed operation result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedops --range 1000 --everything reference.bed \
    | bedmap --bases-uniq - map.bed \
    | paste reference.bed -
</pre></div>
</div>
<p>To extend this demonstration even further, let’s say we are interested in calculations of unique base counts across 1, 2.5 and 5 kilobase windows around reference elements. We can build a matrix-like result through a judicious use of UNIX pipes that progressively expand windows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bedops --range 1000 --everything reference.bed \
  | bedmap --echo --bases-uniq - map.bed \
  | bedops --range 1500 --everything - \
  | bedmap --echo --bases-uniq - map.bed \
  | bedops --range 2500 --everything - \
  | bedmap --echo --bases-uniq - map.bed \
  | cut -f2- -d&#39;|&#39; \
  | paste reference.bed - \
  | tr &#39;|&#39; &#39;\t&#39;
</pre></div>
</div>
<p>To explain how this works, we first build a 1 kilobase window around reference elements with <a class="reference internal" href="../set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> and pipe these windows to <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a>, which does two things:</p>
<ol class="arabic simple">
<li>Use <code class="docutils literal notranslate"><span class="pre">--echo</span></code> to print the windowed element.</li>
<li>Use <code class="docutils literal notranslate"><span class="pre">--bases-uniq</span></code> to print the number of uniquely-mapped bases across the window.</li>
</ol>
<p>In turn, this result is passed to the second <a class="reference internal" href="../set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> operation, which expands the 1-kilobase window from <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> by another 1.5 kilobases. This creates a window that is now 2.5 kilobases around the original reference element. We pipe this to the second <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> operation, which prints the 2.5 kb window and the number of bases across <em>that</em> window.</p>
<p>In the third and last round of operations, we expand the 2.5 kb window by another 2.5 kb, creating a 5000-base window around the original reference element. We repeat the same mapping operation.</p>
<p>At this point, each line of the output consists of a windowed reference element, and pipe characters (the default <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> delimiter) which separate the unique base counts across the 1, 2.5 and 5 kilobase windows. The final <code class="docutils literal notranslate"><span class="pre">cut</span></code>, <code class="docutils literal notranslate"><span class="pre">paste</span></code> and <code class="docutils literal notranslate"><span class="pre">tr</span></code> operations strip out the windows, paste in the original reference elements and replace default delimiters with tab characters, creating a matrix-like output.</p>
<p class="last">To make this analysis run quickly, use the <code class="docutils literal notranslate"><span class="pre">--faster</span></code> modifier on each of the <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a>, if the data allow it. See the following section for more details on where and how <code class="docutils literal notranslate"><span class="pre">--faster</span></code> can be used.</p>
</div>
</div>
<div class="section" id="using-faster-with-range">
<span id="bedmap-using-faster-with-range"></span><h4>6.2.1.3.4.2. Using <code class="docutils literal notranslate"><span class="pre">--faster</span></code> with <code class="docutils literal notranslate"><span class="pre">--range</span></code><a class="headerlink" href="#using-faster-with-range" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">--faster</span></code> modifier works with the <code class="docutils literal notranslate"><span class="pre">--bp-ovr</span></code>, <code class="docutils literal notranslate"><span class="pre">--fraction-both</span></code> and <code class="docutils literal notranslate"><span class="pre">--exact</span></code> (<code class="docutils literal notranslate"><span class="pre">--fraction-both</span> <span class="pre">1</span></code>) overlap and <code class="docutils literal notranslate"><span class="pre">--range</span></code> specifiers to dramatically increase the performance of <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a>, when the following input restriction is met:</p>
<ul class="simple">
<li>No <a class="reference internal" href="../set-operations/nested-elements.html#nested-elements"><span class="std std-ref">fully-nested elements</span></a> in any input mapping file (duplicate elements and other overlapping elements are okay).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The details of this restriction are explained in more detail in the <a class="reference internal" href="../set-operations/nested-elements.html#nested-elements"><span class="std std-ref">nested element documentation</span></a>.</p>
</div>
<p>This option also works with the <code class="docutils literal notranslate"><span class="pre">--ec</span></code> error checking flag, which indicates if the data contain nested elements. Using <code class="docutils literal notranslate"><span class="pre">--ec</span></code> carries its usual overhead, but as it only doubles the much-improved execution time, it may be worth using.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>To give an idea of the speed improvement, a <code class="docutils literal notranslate"><span class="pre">--range</span> <span class="pre">100000</span> <span class="pre">--echo</span> <span class="pre">--count</span></code> operation on 8.4 million, non-nested mapping elements (DNaseI footprints across multiple cell types) took <em>2 minutes and 55 seconds</em> without speed-up. By adding the <code class="docutils literal notranslate"><span class="pre">--faster</span></code> flag, the same calculation took <em>10 seconds</em>. That is an <strong>18-fold</strong> speed improvement.</p>
<p>One scenario where this option can provide great speed gains is where <code class="docutils literal notranslate"><span class="pre">--range</span></code> is used with a large numerical parameter. Another scenario where this option is very useful is where the reference file has large elements, and the mapping file is made up of many small elements—specifically, where a number of small elements overlap each big element from the reference file.</p>
<p>An example of a research application for our lab which benefits from this flag is where we perform statistical analysis of large numbers of small sequence tags that fall in hotspot regions.</p>
<p class="last">If your data meet the <a class="reference internal" href="../set-operations/nested-elements.html#nested-elements"><span class="std std-ref">non-nesting criteria</span></a>, using <code class="docutils literal notranslate"><span class="pre">--faster</span></code> with <code class="docutils literal notranslate"><span class="pre">--bp-ovr</span></code>, <code class="docutils literal notranslate"><span class="pre">--exact</span></code> or <code class="docutils literal notranslate"><span class="pre">--range</span></code> is <strong>highly recommended</strong>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Our lab works with BED data of various types: cut-counts, hotspots, peaks, footprints, etc. These data generally do not contain nested elements and so are amenable to use with <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap’s</span></a> <code class="docutils literal notranslate"><span class="pre">--faster</span></code> flag for extracting overlapping elements.</p>
<p>However, other types of data can be problematic. <a class="reference external" href="http://meme.nbcr.net/meme/fimo-intro.html">FIMO</a> search results (motif hits), for example, may cause trouble, where the boundaries of one motif hit can be contained within another larger hit. Or paired-end sequence data, where tags are not of a fixed length.</p>
<p class="last">Be sure to consider the makeup of your BED data before using <code class="docutils literal notranslate"><span class="pre">--faster</span></code>.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Using <code class="docutils literal notranslate"><span class="pre">--ec</span></code> with <code class="docutils literal notranslate"><span class="pre">--faster</span></code> will report if any nested elements exist in your data. Using <code class="docutils literal notranslate"><span class="pre">--ec</span></code> carries its usual overhead, but as it only doubles the much-improved execution time, it may be worth using.</p>
</div>
</div>
<div class="section" id="formatting-score-output">
<span id="bedmap-formatting-score-output"></span><h4>6.2.1.3.4.3. Formatting score output<a class="headerlink" href="#formatting-score-output" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">--prec</span></code> and <code class="docutils literal notranslate"><span class="pre">--sci</span></code> process flags are useful for controlling the <a class="reference external" href="http://en.wikipedia.org/wiki/Precision_(arithmetic)">arithmetic precision</a> and <a class="reference external" href="http://en.wikipedia.org/wiki/Scientific_notation">notation</a> of score output, when used with the <code class="docutils literal notranslate"><span class="pre">--echo-map-score</span></code>, <code class="docutils literal notranslate"><span class="pre">--sum</span></code>, <code class="docutils literal notranslate"><span class="pre">--mean</span></code> and other numerical score operators. This will also format results from the non-score operator <code class="docutils literal notranslate"><span class="pre">--bases-uniq-f</span></code>.</p>
<p>To demonstrate their use, we revisit the <code class="docutils literal notranslate"><span class="pre">Motifs</span></code> dataset, which includes <em>p</em>-values reporting the statistical significance of putative transcription factor binding sites:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chr1</span>    <span class="mi">4534161</span> <span class="mi">4534177</span> <span class="o">-</span><span class="n">V_GRE_C</span>        <span class="mf">4.20586e-06</span>     <span class="o">-</span>       <span class="n">CGTACACACAGTTCTT</span>
<span class="n">chr1</span>    <span class="mf">4534192.4</span><span class="o">.</span><span class="mi">364205</span> <span class="o">-</span><span class="n">V_STAT_Q6</span>      <span class="mf">2.21622e-06</span>     <span class="o">-</span>       <span class="n">AGCACTTCTGGGA</span>
<span class="n">chr1</span>    <span class="mi">4534209</span> <span class="mi">4534223</span> <span class="o">+</span><span class="n">V_HNF4_Q6_01</span>   <span class="mf">6.93604e-06</span>     <span class="o">+</span>       <span class="n">GGACCAGAGTCCAC</span>
<span class="n">chr1</span>    <span class="mf">4962522.4</span><span class="o">.</span><span class="mi">362540</span> <span class="o">-</span><span class="n">V_GCNF_01</span>      <span class="mf">9.4497e-06</span>      <span class="o">-</span>       <span class="n">CCCAAGGTCAAGATAAAG</span>
<span class="n">chr1</span>    <span class="mi">4962529</span> <span class="mi">4962539</span> <span class="o">+</span><span class="n">V_NUR77_Q5</span>     <span class="mf">8.43564e-06</span>     <span class="o">+</span>       <span class="n">TTGACCTTGG</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Let’s say we want a list of motifs and associated <em>p</em>-values mapped to a coordinate range of interest (<code class="docutils literal notranslate"><span class="pre">chr1:4534150-4534300</span></code>). In order to conserve space, however, we only want two significant figures for the score data. So we use <code class="docutils literal notranslate"><span class="pre">--prec</span> <span class="pre">2</span></code> to try to reformat the score output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr1\t4534150\t4534300\tref-1&quot; \
    | bedmap --prec 2 --echo --echo-map-id --echo-map-score - motifs.bed \
    &gt; motifsForRef1.bed
</pre></div>
</div>
<p>Here is the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chr1</span>    <span class="mi">4534150</span> <span class="mi">4534300</span> <span class="n">ref</span><span class="o">-</span><span class="mi">1</span><span class="o">|-</span><span class="n">V_GRE_C</span><span class="p">;</span><span class="o">-</span><span class="n">V_STAT_Q6</span><span class="p">;</span><span class="o">+</span><span class="n">V_HNF4_Q6_01</span><span class="o">|</span><span class="mf">0.00</span><span class="p">;</span><span class="mf">0.00</span><span class="p">;</span><span class="mf">0.00</span>
</pre></div>
</div>
<p>It looks like our <em>p</em>-values were rounded down to zeroes, which is not what we want. But we remember that the binding site <em>p</em>-values are listed in scientific notation, and so we add the <code class="docutils literal notranslate"><span class="pre">--sci</span></code> flag to preserve the format of the score data in scientific notation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr1\t4534150\t4534300\tref-1&quot; \
    | bedmap --prec 2 --sci --echo --echo-map-id --echo-map-score - motifs.bed \
    &gt; correctedMotifsForRef1.bed
</pre></div>
</div>
<p>Here is the corrected output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chr1</span>    <span class="mi">4534150</span> <span class="mi">4534300</span> <span class="n">ref</span><span class="o">-</span><span class="mi">1</span><span class="o">|-</span><span class="n">V_GRE_C</span><span class="p">;</span><span class="o">-</span><span class="n">V_STAT_Q6</span><span class="p">;</span><span class="o">+</span><span class="n">V_HNF4_Q6_01</span><span class="o">|</span><span class="mf">4.21e-06</span><span class="p">;</span><span class="mf">2.22e-06</span><span class="p">;</span><span class="mf">6.94e-06</span>
</pre></div>
</div>
<p>Rounding of the mantissa is done to the precision specified in <code class="docutils literal notranslate"><span class="pre">--prec</span></code>.</p>
<p>Obviously, the <code class="docutils literal notranslate"><span class="pre">--sci</span></code> flag is useful for very small or large score data. You probably wouldn’t use <code class="docutils literal notranslate"><span class="pre">--sci</span></code> with most integer signal (<em>e.g.</em>, raw tag counts or most discrete measurements).</p>
</div>
<div class="section" id="delimiters">
<span id="bedmap-delimiters"></span><h4>6.2.1.3.4.4. Delimiters<a class="headerlink" href="#delimiters" title="Permalink to this headline">¶</a></h4>
<p>As shown in the examples above, the pipe (<code class="docutils literal notranslate"><span class="pre">|</span></code>) and semi-colon (<code class="docutils literal notranslate"><span class="pre">;</span></code>) characters are used to split operational and <code class="docutils literal notranslate"><span class="pre">echo</span></code>-ed results, respectively. The <code class="docutils literal notranslate"><span class="pre">--delim</span></code> and <code class="docutils literal notranslate"><span class="pre">--multidelim</span></code> flags change these delimiters to characters of your choice, which let you pick what makes most sense for your custom post-processing or other downstream pipelining work (for instance, in our lab <code class="docutils literal notranslate"><span class="pre">--delim</span> <span class="pre">&quot;\t&quot;</span></code> is a popular alternative to the default <code class="docutils literal notranslate"><span class="pre">|</span></code> character).</p>
<p>As an example, the following <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> result is obtained from using the <code class="docutils literal notranslate"><span class="pre">--echo</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-map-id</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-map-score</span></code> and <code class="docutils literal notranslate"><span class="pre">--max</span></code> options on the <code class="docutils literal notranslate"><span class="pre">Motifs</span></code> dataset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chr1</span>    <span class="mi">4534150</span> <span class="mi">4534300</span> <span class="n">ref</span><span class="o">-</span><span class="mi">1</span><span class="o">|-</span><span class="n">V_GRE_C</span><span class="p">;</span><span class="o">-</span><span class="n">V_STAT_Q6</span><span class="p">;</span><span class="o">+</span><span class="n">V_HNF4_Q6_01</span><span class="o">|</span><span class="mf">4.21e-06</span><span class="p">;</span><span class="mf">2.22e-06</span><span class="p">;</span><span class="mf">6.94e-06</span><span class="o">|</span><span class="mf">6.94e-06</span>
</pre></div>
</div>
<p>For this result, the <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> program organizes data using the default set of delimiters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">reference</span><span class="o">-</span><span class="n">line</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="nb">map</span><span class="o">-</span><span class="n">IDs</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="nb">map</span><span class="o">-</span><span class="n">scores</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="n">maximum</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="n">score</span><span class="p">]</span>
</pre></div>
</div>
<p>Here, you can use the <code class="docutils literal notranslate"><span class="pre">--delim</span></code> option to replace the pipe character with an alternative delimiter.</p>
<p>Within the <code class="docutils literal notranslate"><span class="pre">map-IDs</span></code> and <code class="docutils literal notranslate"><span class="pre">map-scores</span></code> subgroups, individual results are split further by semi-colon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">;</span> <span class="p">[</span><span class="nb">id</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">;</span> <span class="o">...</span> <span class="p">;</span> <span class="p">[</span><span class="nb">id</span><span class="o">-</span><span class="n">N</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">score</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">;</span> <span class="p">[</span><span class="n">score</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">;</span> <span class="o">...</span> <span class="p">;</span> <span class="p">[</span><span class="n">score</span><span class="o">-</span><span class="n">N</span><span class="p">]</span>
</pre></div>
</div>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">--multidelim</span></code> option to replace the semi-colon with another delimiter, <em>e.g.</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr1\t4534150\t4534300\tref-1&quot; | bedmap --multidelim &#39;$&#39; --echo --echo-map-id - motifs.bed
chr1    4534150 4534300 ref-1|-V_GRE_C$-V_STAT_Q6$+V_HNF4_Q6_01
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Grouped results derived with the <code class="docutils literal notranslate"><span class="pre">--echo-map</span></code>, <code class="docutils literal notranslate"><span class="pre">--echo-map-id</span></code>, and <code class="docutils literal notranslate"><span class="pre">--echo-map-score</span></code> options are listed in identical order. In other words, ID results line up at the same position as their score result counterparts when both <code class="docutils literal notranslate"><span class="pre">--echo-map-id</span></code> and <code class="docutils literal notranslate"><span class="pre">--echo-map-score</span></code> are chosen together. The same applies to the <code class="docutils literal notranslate"><span class="pre">--echo-map</span></code> option.</p>
</div>
</div>
</div>
</div>
<div class="section" id="i-o-event-handling">
<span id="bedmap-io-event-handling"></span><h2>6.2.1.4. I/O event handling<a class="headerlink" href="#i-o-event-handling" title="Permalink to this headline">¶</a></h2>
<p>During normal use of <code class="docutils literal notranslate"><span class="pre">bedmap</span></code>, the application will usually terminate when it is determined that no more map data needs to be processed. This improves performance by limiting execution time to only that which is required to do actual work. However, closing early can trigger <code class="docutils literal notranslate"><span class="pre">SIGPIPE</span></code> or broken pipe errors that can cause batch scripts that use the standard input stream to pass data to <code class="docutils literal notranslate"><span class="pre">bedmap</span></code> to terminate early with an error state (even though there is often no functional problem from this early termination of <code class="docutils literal notranslate"><span class="pre">bedmap</span></code>).</p>
<p>When adding <code class="docutils literal notranslate"><span class="pre">--ec</span></code>, <code class="docutils literal notranslate"><span class="pre">bedmap</span></code> will go into <a class="reference internal" href="#bedmap-error-checking"><span class="std std-ref">error checking mode</span></a> and read through the entire map dataset.</p>
<p>One method for dealing with this is to override how <code class="docutils literal notranslate"><span class="pre">SIGPIPE</span></code> errors are caught by the interpreter (bash, Python, etc.) and retrapping them or ignoring them. However, it may not a good idea to do this as other situations may arise in production pipelines where it is ideal to trap and handle all I/O errors in a default manner.</p>
<p>Until now, we have proposed using the <code class="docutils literal notranslate"><span class="pre">--ec</span></code> (error checking) option in <code class="docutils literal notranslate"><span class="pre">bedmap</span></code> as one way to prevent raising <code class="docutils literal notranslate"><span class="pre">SIGPIPE</span></code> events when chaining commands via pipes, by forcing all inputs to be read entirely.  Early pipe termination can cause scripts to stop processing when certain flags are set (for example, when -e is used with tcsh).  This hidden behavior of <code class="docutils literal notranslate"><span class="pre">--ec</span></code> has been replaced with the explicit option <code class="docutils literal notranslate"><span class="pre">--sweep-all</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--ec</span></code> and <code class="docutils literal notranslate"><span class="pre">--sweep-all</span></code> options work independently, and <code class="docutils literal notranslate"><span class="pre">--ec</span></code> no longer has the <code class="docutils literal notranslate"><span class="pre">--sweep-all</span></code> side-effect.  These options may be used in conjunction.  The <code class="docutils literal notranslate"><span class="pre">--sweep-all</span></code> option can add significant execution time in cases where early termination is possible.</p>
</div>
<div class="section" id="per-chromosome-operations-chrom">
<span id="bedmap-per-chromosome-operations"></span><h2>6.2.1.5. Per-chromosome operations (–chrom)<a class="headerlink" href="#per-chromosome-operations-chrom" title="Permalink to this headline">¶</a></h2>
<p>All operations on inputs described so far can be restricted to one chromosome, by adding the <code class="docutils literal notranslate"><span class="pre">--chrom</span> <span class="pre">&lt;val&gt;</span></code> operator. This is highly useful for cluster-based work, where operations on large BED inputs can be split up by chromosome and pushed to separate cluster nodes.</p>
<p>Here, we use the <code class="docutils literal notranslate"><span class="pre">--echo</span></code> and <code class="docutils literal notranslate"><span class="pre">--echo-map-id</span></code> operators on our <code class="docutils literal notranslate"><span class="pre">Motifs</span></code> dataset, but we limit operations to those on elements on chromosome <code class="docutils literal notranslate"><span class="pre">chr2</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr2\t1000000\t5000000\tref-1&quot; | bedmap --chrom chr2 --echo --echo-map-id - motifs.bed
chr2    1000000 5000000 ref-1|+V_OCT1_05;+V_OCT_C;-V_CACD_01;+V_IRF_Q6;-V_BLIMP1_Q6;-V_IRF2_01;-V_IRF_Q6_01
</pre></div>
</div>
<p>If the reference elements are not on the specified chromosome provided to <code class="docutils literal notranslate"><span class="pre">--chrom</span></code>, then no output is generated. In the following example, our reference element is on <code class="docutils literal notranslate"><span class="pre">chr2</span></code>, but we ask for operations to be limited to <code class="docutils literal notranslate"><span class="pre">chr3</span></code>, yielding an empty set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr2\t1000000\t5000000\tref-1&quot; | bedmap --chrom chr3 --echo --echo-map-id - motifs.bed
$
</pre></div>
</div>
</div>
<div class="section" id="starch-support">
<span id="bedmap-starch-support"></span><h2>6.2.1.6. Starch support<a class="headerlink" href="#starch-support" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> application supports use of <a class="reference internal" href="../file-management/compression/starch.html#starch"><span class="std std-ref">Starch-formatted archives</span></a> as inputs, as well as text-based BED data. One or multiple inputs may be Starch archives.</p>
<p>For example, we can repeat the overlapping-motif example from the <a class="reference internal" href="#bedmap-echo"><span class="std std-ref">Echo section</span></a>, using a Starch archive made from the regions in <code class="docutils literal notranslate"><span class="pre">Motifs</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo -e &quot;chr1\t4534150\t4534300\tref-1&quot; | bedmap --echo --echo-map-id - motifs.bed.starch
chr1    4534150 4534300 ref-1|-V_GRE_C;-V_STAT_Q6;+V_HNF4_Q6_01
</pre></div>
</div>
<p>By combining the <code class="docutils literal notranslate"><span class="pre">--chrom</span></code> operator with operations on Starch archives, the end user can achieve improved computing performance and disk space savings, particularly where <a class="reference internal" href="../set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a>, <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> and <a class="reference internal" href="../set-operations/closest-features.html#closest-features"><span class="std std-ref">closest-features</span></a> operations are applied with a computational cluster on separate chromosomes.</p>
</div>
<div class="section" id="error-checking">
<span id="bedmap-error-checking"></span><h2>6.2.1.7. Error checking<a class="headerlink" href="#error-checking" title="Permalink to this headline">¶</a></h2>
<p>The bedmap program does not perform error checking by default, but it offers an <code class="docutils literal notranslate"><span class="pre">--ec</span></code> option for comprehensive checks.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use of the <code class="docutils literal notranslate"><span class="pre">--ec</span></code> option will roughly double the running time, but it provides stringent error checking to ensure all inputs are valid. <code class="docutils literal notranslate"><span class="pre">--ec</span></code> can help check problematic input and offers helpful hints for any needed corrections, when problems are detected.</p>
</div>
</div>
<div class="section" id="endlines">
<span id="bedmap-endlines"></span><h2>6.2.1.8. Endlines<a class="headerlink" href="#endlines" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#bedmap"><span class="std std-ref">bedmap</span></a> program expects endlines (<code class="docutils literal notranslate"><span class="pre">\n</span></code>) appropriate to Linux and Mac OS X operating systems. Microsoft Windows uses different characters for endlines. In UNIX-like environments, you can quickly check to see if your file contains the native endlines with this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ head myData.bed | cat -et
</pre></div>
</div>
<p>The appropriate endlines will show up as a <code class="docutils literal notranslate"><span class="pre">$</span></code> character at the end of each line. See the <code class="docutils literal notranslate"><span class="pre">dos2unix</span></code> program (sometimes called <code class="docutils literal notranslate"><span class="pre">fromdos</span></code>) to convert newlines from files saved on Microsoft Windows. The <code class="docutils literal notranslate"><span class="pre">unix2dos</span></code> (or <code class="docutils literal notranslate"><span class="pre">todos</span></code>) program can convert files in the other direction, if needed.</p>
</div>
<div class="section" id="downloads">
<span id="bedmap-downloads"></span><h2>6.2.1.9. Downloads<a class="headerlink" href="#downloads" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Sample <code class="docutils literal notranslate"><span class="pre">Reference</span></code> dataset: <a class="reference download internal" download="" href="../../../_downloads/42f87a26122ebdb4ee41497f2edce413/reference_bedmap_reference.bed"><code class="xref download docutils literal notranslate"><span class="pre">reference</span> <span class="pre">elements</span></code></a></li>
<li>Sample <code class="docutils literal notranslate"><span class="pre">Map</span></code> dataset: <a class="reference download internal" download="" href="../../../_downloads/5713f5e307a2495dd9167ea832bb8002/reference_bedmap_map.bed"><code class="xref download docutils literal notranslate"><span class="pre">map</span> <span class="pre">elements</span></code></a></li>
<li>Sample <code class="docutils literal notranslate"><span class="pre">Motifs</span></code> dataset: <a class="reference download internal" download="" href="../../../_downloads/c513c2e87396ea4a3a06021682e6b070/reference_bedmap_motifs.bed"><code class="xref download docutils literal notranslate"><span class="pre">motif</span> <span class="pre">elements</span></code></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo_with_label_v3.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">6.2.1. <cite>bedmap</cite></a><ul>
<li><a class="reference internal" href="#inputs-and-outputs">6.2.1.1. Inputs and outputs</a><ul>
<li><a class="reference internal" href="#input">6.2.1.1.1. Input</a></li>
<li><a class="reference internal" href="#output">6.2.1.1.2. Output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">6.2.1.2. Usage</a></li>
<li><a class="reference internal" href="#operations">6.2.1.3. Operations</a><ul>
<li><a class="reference internal" href="#overlap-criteria">6.2.1.3.1. Overlap criteria</a><ul>
<li><a class="reference internal" href="#using-faster-with-bp-ovr-fraction-both-exact-or-range">6.2.1.3.1.1. Using <code class="docutils literal notranslate"><span class="pre">--faster</span></code> with <code class="docutils literal notranslate"><span class="pre">--bp-ovr</span></code>, <code class="docutils literal notranslate"><span class="pre">--fraction-both</span></code>, <code class="docutils literal notranslate"><span class="pre">--exact</span></code> or <code class="docutils literal notranslate"><span class="pre">--range</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#score-operations">6.2.1.3.2. Score operations</a></li>
<li><a class="reference internal" href="#non-score-operations">6.2.1.3.3. Non-score operations</a><ul>
<li><a class="reference internal" href="#echo">6.2.1.3.3.1. Echo</a></li>
<li><a class="reference internal" href="#element-and-overlap-statistics">6.2.1.3.3.2. Element and overlap statistics</a></li>
<li><a class="reference internal" href="#indicator">6.2.1.3.3.3. Indicator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modifiers">6.2.1.3.4. Modifiers</a><ul>
<li><a class="reference internal" href="#range">6.2.1.3.4.1. Range</a></li>
<li><a class="reference internal" href="#using-faster-with-range">6.2.1.3.4.2. Using <code class="docutils literal notranslate"><span class="pre">--faster</span></code> with <code class="docutils literal notranslate"><span class="pre">--range</span></code></a></li>
<li><a class="reference internal" href="#formatting-score-output">6.2.1.3.4.3. Formatting score output</a></li>
<li><a class="reference internal" href="#delimiters">6.2.1.3.4.4. Delimiters</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#i-o-event-handling">6.2.1.4. I/O event handling</a></li>
<li><a class="reference internal" href="#per-chromosome-operations-chrom">6.2.1.5. Per-chromosome operations (–chrom)</a></li>
<li><a class="reference internal" href="#starch-support">6.2.1.6. Starch support</a></li>
<li><a class="reference internal" href="#error-checking">6.2.1.7. Error checking</a></li>
<li><a class="reference internal" href="#endlines">6.2.1.8. Endlines</a></li>
<li><a class="reference internal" href="#downloads">6.2.1.9. Downloads</a></li>
</ul>
</li>
</ul>

<form class="search" action="../../../search.html" method="get">
  <input type="text" name="q"
   placeholder="type to search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="related bottom">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="../statistics.html" title="Previous document">6.2. Statistics</a>
        </li>
        <li>
          <a href="../file-management.html" title="Next document">6.3. File management</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../../../index.html">Home</a></li>
      <li>
        <a href="../../reference.html">6. Reference</a>
      </li>
      <li>
        <a href="../statistics.html">6.2. Statistics</a>
      </li> 
    </ul>
  </nav>
  </div>
  <footer id="pagefooter">&copy; 2011-2019, Shane Neph, Alex Reynolds.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a>
      1.8.5
        with the <a href="http://github.com/irskep/sphinx-better-theme">
          better</a> theme.

  </footer>

  
  </body>
</html>