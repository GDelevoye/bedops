
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>5. Performance &#8212; BEDOPS v2.4.36</title>
    <link rel="stylesheet" href="../_static/better.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Reference" href="reference.html" />
    <link rel="prev" title="4.7. Working with many input files at once with bedops and bedmap" href="usage-examples/multiple-inputs.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  </head><body>
    <header id="pageheader"><h1><a href="../index.html ">
        BEDOPS v2.4.36
    </a></h1></header>
  <div class="related top">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="usage-examples/multiple-inputs.html" title="Previous document">4.7. Working with many input files at once with <code class="docutils literal notranslate"><span class="pre">bedops</span></code> and <code class="docutils literal notranslate"><span class="pre">bedmap</span></code></a>
        </li>
        <li>
          <a href="reference.html" title="Next document">6. Reference</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../index.html">Home</a></li> 
    </ul>
  </nav>
  </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="performance">
<h1>5. Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h1>
<p>In this document, we compare the performance of our set operations and compression utilities with common alternatives. In-house performance measures include speed, memory usage, and compression efficiency on a dual-core machine with 18 GB of virtual memory. Additionally, we report independently-generated performance statistics collected by a research group that has recently released a similar analysis toolkit.</p>
<div class="section" id="test-environment-and-data">
<h2>5.1. Test environment and data<a class="headerlink" href="#test-environment-and-data" title="Permalink to this headline">¶</a></h2>
<p>Timed results were derived using actual running times (also known as wall-clock times), averaged over 3 runs. All timed tests were performed using a single 64-bit Linux machine with a dual-core 3 GHz Intel Xeon processor, 8 GB of physical RAM, and 18 GB of total virtual memory. All caches were purged in between sequential program runs to remove hardware biases.</p>
<p>Random subsamples of <a class="reference external" href="http://compgen.bscb.cornell.edu/phast/">phyloP conservation</a> for the human genome were used as inputs for testing whenever the full phyloP results were not used. The full phyloP results were downloaded from <a class="reference external" href="http://hgdownload.cse.ucsc.edu/goldenPath/hg19/phyloP46way/">UCSC</a>.</p>
</div>
<div class="section" id="set-operations-with-bedops">
<h2>5.2. Set operations with <code class="docutils literal notranslate"><span class="pre">bedops</span></code><a class="headerlink" href="#set-operations-with-bedops" title="Permalink to this headline">¶</a></h2>
<p>In this section, we provide time and memory measurements of various <a class="reference internal" href="reference/set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> operations against analogous <a class="reference external" href="http://code.google.com/p/bedtools/">BEDTools</a> utilities.</p>
<div class="section" id="direct-merge-sorted">
<h3>5.2.1. Direct merge (sorted)<a class="headerlink" href="#direct-merge-sorted" title="Permalink to this headline">¶</a></h3>
<p>The performance of the <code class="docutils literal notranslate"><span class="pre">mergeBed</span></code> program (with the <code class="docutils literal notranslate"><span class="pre">-i</span></code> option) from the BEDTools suite (v2.12.0) was compared with that of the <code class="docutils literal notranslate"><span class="pre">--merge</span></code> option of our <a class="reference internal" href="reference/set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> utility.</p>
<a class="reference internal image-reference" href="../_images/performance_bedops_merge_sorted.png"><img alt="../_images/performance_bedops_merge_sorted.png" src="../_images/performance_bedops_merge_sorted.png" style="width: 99%;" /></a>
<p>As measured, the <code class="docutils literal notranslate"><span class="pre">mergeBed</span></code> program loads all data from a file into memory and creates an index before computing results, incurring longer run times and higher memory costs that can lead to failures. The <a class="reference internal" href="reference/set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> utility minimizes memory consumption by retaining only the information required to compute the next line of output.</p>
</div>
<div class="section" id="complement-and-intersection">
<h3>5.2.2. Complement and intersection<a class="headerlink" href="#complement-and-intersection" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">complementBed</span></code> (with <code class="docutils literal notranslate"><span class="pre">-i</span></code> and <code class="docutils literal notranslate"><span class="pre">-g</span></code> options) and <code class="docutils literal notranslate"><span class="pre">intersectBed</span></code> (with <code class="docutils literal notranslate"><span class="pre">-u</span></code>, <code class="docutils literal notranslate"><span class="pre">-a</span></code>, and <code class="docutils literal notranslate"><span class="pre">-b</span></code> options) programs from the BEDTools suite (v2.12.0) also were compared to our <a class="reference internal" href="reference/set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> program.</p>
<a class="reference internal image-reference" href="../_images/performance_bedops_complement_sorted.png"><img alt="../_images/performance_bedops_complement_sorted.png" src="../_images/performance_bedops_complement_sorted.png" style="width: 99%;" /></a>
<a class="reference internal image-reference" href="../_images/performance_bedops_intersect_sorted.png"><img alt="../_images/performance_bedops_intersect_sorted.png" src="../_images/performance_bedops_intersect_sorted.png" style="width: 99%;" /></a>
<p>Both BEDTools programs were unable to complete operations after 51M elements with the allocated 18 GB of memory. The <a class="reference internal" href="reference/set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> program continued operating on the full dataset.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>It is our understanding that the BEDTools’ <code class="docutils literal notranslate"><span class="pre">intersectBed</span></code> program was modified to accept (optionally) sorted data for improved performance some time after these results were published.</p>
<p class="last">A <a class="reference internal" href="#independent-testing"><span class="std std-ref">more recent study</span></a> suggests <code class="docutils literal notranslate"><span class="pre">bedops</span> <span class="pre">--intersect</span></code> still offers better memory and running time performance characteristics than recent versions of BEDTools.</p>
</div>
</div>
<div class="section" id="direct-merge-unsorted">
<h3>5.2.3. Direct merge (unsorted)<a class="headerlink" href="#direct-merge-unsorted" title="Permalink to this headline">¶</a></h3>
<p>In typical pipelines, where utilities are chained together to perform more complex operations, the performance and scalability gaps between BEDOPS and competitive tool suites widen. We show here the use of <a class="reference internal" href="reference/file-management/sorting/sort-bed.html#sort-bed"><span class="std std-ref">sort-bed</span></a> on unsorted BED input, piping it to BEDOPS tools:</p>
<a class="reference internal image-reference" href="../_images/performance_bedops_merge_unsorted.png"><img alt="../_images/performance_bedops_merge_unsorted.png" src="../_images/performance_bedops_merge_unsorted.png" style="width: 99%;" /></a>
<p>Time performance of <a class="reference internal" href="reference/set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> stays under that of <code class="docutils literal notranslate"><span class="pre">mergeBed</span></code> (BEDTools v2.12), while continuing past the point where <code class="docutils literal notranslate"><span class="pre">mergeBed</span></code> fails. Memory limitations of the system are easily overcome by using the <code class="docutils literal notranslate"><span class="pre">--max-mem</span></code> operator with <a class="reference internal" href="reference/file-management/sorting/sort-bed.html#sort-bed"><span class="std std-ref">sort-bed</span></a>, allowing the <code class="docutils literal notranslate"><span class="pre">--merge</span></code> operation to continue unimpeded even with ever-larger unsorted BED inputs.</p>
</div>
<div class="section" id="discussion">
<h3>5.2.4. Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="reference/set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> utility performs a wide range of set operations (merge, intersect, union, symmetric difference, and so forth). As with all main utilities in BEDOPS, the program requires <a class="reference internal" href="reference/file-management/sorting/sort-bed.html#sort-bed"><span class="std std-ref">sorted</span></a> inputs and creates sorted results on output. As such, sorting is, at most, a <em>one-time cost</em> to operate on data any number of times in the most efficient way. Also, as shown in an <a class="reference internal" href="#independent-testing"><span class="std std-ref">independent study</span></a>, BEDOPS also sorts data more efficiently than other tools. Further, our utility can sort BED inputs of any size.</p>
<p>Another important feature of <a class="reference internal" href="reference/set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> that separates it from the competition is its ability to work with <a class="reference internal" href="usage-examples/multiple-inputs.html#multiple-inputs"><span class="std std-ref">any number of inputs</span></a> at once. Every operation (union, difference, intersection, and so forth) accepts an arbitrary number of inputs, and each input can be of any size.</p>
</div>
</div>
<div class="section" id="compression-characteristics-of-starch">
<h2>5.3. Compression characteristics of <code class="docutils literal notranslate"><span class="pre">starch</span></code><a class="headerlink" href="#compression-characteristics-of-starch" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="reference/file-management/compression/starch.html#starch"><span class="std std-ref">starch</span></a> utility offers high-quality BED compression into a format with a smaller footprint than common alternatives. The format is designed to help manage data bloat in this genomic era. Further, the format actually enables improved access times to the vast majority of datasets, as compared with raw (uncompressed) and naively-compressed data.</p>
<p>Here, we provide two measures of this format’s utility: comparing the compression efficiency of the <code class="docutils literal notranslate"><span class="pre">bzip2</span></code>-backed Starch format against common, “naive” <code class="docutils literal notranslate"><span class="pre">bzip2</span></code>-compression of UCSC <a class="reference external" href="http://genome.ucsc.edu/goldenPath/help/bedgraph.html">BedGraph</a> and <a class="reference external" href="http://genome.ucsc.edu/goldenPath/help/wiggle.html">WIG</a> forms of BED data, and by comparing the time required to extract the records for any one chromosome from these formats as well as from a raw (uncompressed) BED file.</p>
<div class="section" id="compression-efficiency">
<h3>5.3.1. Compression efficiency<a class="headerlink" href="#compression-efficiency" title="Permalink to this headline">¶</a></h3>
<p>After just 10K rows (roughly 300 kB of raw BED data storing phyloP conservation scores), compression into the Starch format begins to consistently outperform <code class="docutils literal notranslate"><span class="pre">bzip2</span></code> compression of the same data stored in either variable-step WIG or UCSC BedGraph formats.</p>
<a class="reference internal image-reference" href="../_images/performance_starch_efficiency.png"><img alt="../_images/performance_starch_efficiency.png" src="../_images/performance_starch_efficiency.png" style="width: 99%;" /></a>
<p>For very large raw BED datasets, the Starch format stores the original data in approximately 5% of the original input size. These improved compression results generalize to compressed versions of the fixed-step WIG format, as well. For more information, refer to the Supplemental Data in our <a class="reference external" href="http://bioinformatics.oxfordjournals.org/content/28/14/1919.abstract">Bioinformatics</a> paper.</p>
</div>
<div class="section" id="extraction-time">
<h3>5.3.2. Extraction time<a class="headerlink" href="#extraction-time" title="Permalink to this headline">¶</a></h3>
<p>Data were sorted per sort-bed with chromosomes in lexicographical order. Extractions by chromosomes were significantly faster in general with the Starch format, even over raw (sequentially-processed) BED inputs:</p>
<a class="reference internal image-reference" href="../_images/performance_unstarch_extractiontime.png"><img alt="../_images/performance_unstarch_extractiontime.png" src="../_images/performance_unstarch_extractiontime.png" style="width: 99%;" /></a>
<p>Under the assumption that chromosomes create very natural partitions of the data, the Starch format was designed using a chromosome-indexing scheme. This mechanism for random access further helps to improve data processing times within a clustered environment. Again, for more information, refer to the Supplemental Data in our <a class="reference external" href="http://bioinformatics.oxfordjournals.org/content/28/14/1919.abstract">Bioinformatics</a> paper.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Our <a class="reference internal" href="reference/set-operations/bedextract.html#bedextract"><span class="std std-ref">bedextract</span></a> program similarly makes it possible to extract data quickly by chromosome in any properly sorted BED file. However, for large (or many) data sets, deep compression has serious benefit. In our lab, more than 99% of all files are not touched (even) on a monthly basis—and new results are generated every day. Why would we want to keep all of that data in fully-bloated BED form? The workhorse programs of BEDOPS accept inputs in Starch format directly, just as they do raw BED files, to help manage ‘big data’.</p>
</div>
</div>
</div>
<div class="section" id="independent-testing">
<span id="id2"></span><h2>5.4. Independent testing<a class="headerlink" href="#independent-testing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="genomic-region-operation-kit-grok">
<h3>5.4.1. Genomic Region Operation Kit (GROK)<a class="headerlink" href="#genomic-region-operation-kit-grok" title="Permalink to this headline">¶</a></h3>
<p>Ovaska, et al. independently developed a genomic analysis toolkit called Genomic Region Operation Kit (GROK), which is described in more detail in <a class="reference external" href="http://ieeexplore.ieee.org/xpl/login.jsp?tp=&amp;arnumber=6399464&amp;isnumber=4359833">their publication in IEEE/ACM Transactions on Computational Biology and Bioinformatics</a>.</p>
<p>In it, they compare the performance characteristics of their GROK toolkit with their analogs in the BEDTools and BEDOPS suites, which they summarize as follows:</p>
<div class="topic">
<p class="topic-title first">Results</p>
<p>Results of the benchmark analyses are shown in Table VII. GROK and BEDTools perform at comparable levels for speed and memory efficiency. In this benchmark BEDOPS is the fastest and least memory consuming method, which was expected due to performance optimized implementation of its operations <sup>9</sup>. The optimized performance of BEDOPS, however, entails stronger assumptions for the input than GROK and BEDTools, in particular the requirement for pre-sorting the input BED files.</p>
</div>
<p>Operational input was a 14 MB BED file containing annotations of human gene and exon coordinates, totaling ~423k records. We summarize the results of operations on that input here:</p>
<a class="reference internal image-reference" href="../_images/performance_independent_grok.png"><img alt="../_images/performance_independent_grok.png" src="../_images/performance_independent_grok.png" style="width: 99%;" /></a>
<p>Remember that with BEDOPS, sorting is, at most, a <em>one-time cost</em> to operate on data any number of times in the most efficient way. Since the programs in BEDOPS produce sorted outputs, you never need to sort results before using them in downstream analyses.</p>
</div>
</div>
<div class="section" id="worst-case-memory-performance">
<h2>5.5. Worst-case memory performance<a class="headerlink" href="#worst-case-memory-performance" title="Permalink to this headline">¶</a></h2>
<p>Non-sorting utilities operate efficiently with large inputs by keeping memory overhead low. The worst-case design scenario, however, causes the <a class="reference internal" href="reference/set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a> or <a class="reference internal" href="reference/statistics/bedmap.html#bedmap"><span class="std std-ref">bedmap</span></a> programs to load all data from a single chromosome from a single input file into memory. For <a class="reference internal" href="reference/set-operations/bedops.html#bedops"><span class="std std-ref">bedops</span></a>, the worst-case scenario applies only to the <code class="docutils literal notranslate"><span class="pre">--element-of</span></code> and <code class="docutils literal notranslate"><span class="pre">--not-element-of</span></code> options.</p>
<p>Fortunately, worst-case situations are conceptually easy to understand, and their underlying questions often require no windowing logic to answer, so simpler approaches can sometimes be used. Conceptually, any summary analysis over an entire chromosome triggers the worst-case scenario. For example, to determine the number of sequencing tags mapped to a given chromosome, <a class="reference internal" href="reference/statistics/bedmap.html#bedmap"><span class="std std-ref">bedmap</span></a> loads all tag data for that one chromosome into memory, whereas a one-line <code class="docutils literal notranslate"><span class="pre">awk</span></code> statement can provide the answer with minimal memory overhead.</p>
<p>We note that the worst case memory performance of non-sorting BEDOPS utilities still improves upon the best case performance of current alternatives.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo_with_label_v3.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5. Performance</a><ul>
<li><a class="reference internal" href="#test-environment-and-data">5.1. Test environment and data</a></li>
<li><a class="reference internal" href="#set-operations-with-bedops">5.2. Set operations with <code class="docutils literal notranslate"><span class="pre">bedops</span></code></a><ul>
<li><a class="reference internal" href="#direct-merge-sorted">5.2.1. Direct merge (sorted)</a></li>
<li><a class="reference internal" href="#complement-and-intersection">5.2.2. Complement and intersection</a></li>
<li><a class="reference internal" href="#direct-merge-unsorted">5.2.3. Direct merge (unsorted)</a></li>
<li><a class="reference internal" href="#discussion">5.2.4. Discussion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compression-characteristics-of-starch">5.3. Compression characteristics of <code class="docutils literal notranslate"><span class="pre">starch</span></code></a><ul>
<li><a class="reference internal" href="#compression-efficiency">5.3.1. Compression efficiency</a></li>
<li><a class="reference internal" href="#extraction-time">5.3.2. Extraction time</a></li>
</ul>
</li>
<li><a class="reference internal" href="#independent-testing">5.4. Independent testing</a><ul>
<li><a class="reference internal" href="#genomic-region-operation-kit-grok">5.4.1. Genomic Region Operation Kit (GROK)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#worst-case-memory-performance">5.5. Worst-case memory performance</a></li>
</ul>
</li>
</ul>

<form class="search" action="../search.html" method="get">
  <input type="text" name="q"
   placeholder="type to search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="related bottom">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="usage-examples/multiple-inputs.html" title="Previous document">4.7. Working with many input files at once with <code class="docutils literal notranslate"><span class="pre">bedops</span></code> and <code class="docutils literal notranslate"><span class="pre">bedmap</span></code></a>
        </li>
        <li>
          <a href="reference.html" title="Next document">6. Reference</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../index.html">Home</a></li> 
    </ul>
  </nav>
  </div>
  <footer id="pagefooter">&copy; 2011-2019, Shane Neph, Alex Reynolds.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a>
      1.8.5
        with the <a href="http://github.com/irskep/sphinx-better-theme">
          better</a> theme.

  </footer>

  
  </body>
</html>